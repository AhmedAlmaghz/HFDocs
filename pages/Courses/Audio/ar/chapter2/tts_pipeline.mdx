# توليد الصوت باستخدام خط أنابيب

يشمل توليد الصوت مجموعة متنوعة من المهام التي تنطوي على إنتاج مخرجات صوتية. المهام التي سنلقي نظرة عليها هنا هي توليد الكلام (المعروف أيضًا باسم "النص إلى كلام") وتوليد الموسيقى. في النص إلى كلام، يحول النموذج قطعة من النص إلى صوت لغة منطوقة واقعي، مما يفتح الباب أمام تطبيقات مثل المساعدين الافتراضيين، وأدوات الوصول للأشخاص ضعاف البصر، والكتب الصوتية المخصصة.

من ناحية أخرى، يمكن أن يمكّن توليد الموسيقى التعبير الإبداعي، ويستخدم بشكل أساسي في صناعات الترفيه وتطوير الألعاب.

في 🤗 Transformers، ستجد خط أنابيب يغطي كلتا المهمتين. يُطلق على هذا الخط أنابيب اسم "النص إلى الصوت"، ولكن لراحتك، لديه أيضًا اسم مستعار "النص إلى كلام". هنا سنستخدم كلا الاسمين، وأنت حر في اختيار أيهما يبدو أكثر قابلية للتطبيق لمهمتك.

دعونا نستكشف كيف يمكنك استخدام هذا الخط أنابيب لبدء توليد السرد الصوتي للنصوص والموسيقى ببضع سطور من التعليمات البرمجية.

هذا الخط أنابيب جديد لـ 🤗 Transformers وهو جزء من إصدار 4.32. وبالتالي، ستحتاج إلى ترقية المكتبة إلى أحدث إصدار للحصول على الميزة:

```bash
pip install --upgrade transformers
```

## توليد الكلام

دعونا نبدأ باستكشاف توليد النص إلى كلام. أولاً، تمامًا كما كان الحال مع تصنيف الصوت والتعرف التلقائي على الكلام، سيتعين علينا تحديد خط الأنابيب. سنقوم بتعريف خط أنابيب النص إلى كلام لأنه يصف مهمتنا بشكل أفضل، واستخدام نقطة التحقق [`suno/bark-small`](https://huggingface.co/suno/bark-small):

```python
from transformers import pipeline

pipe = pipeline("text-to-speech", model="suno/bark-small")
```

الخطوة التالية بسيطة مثل تمرير بعض النص عبر خط الأنابيب. سيتم تنفيذ جميع المعالجة المسبقة لنا تحت الغطاء:

```python
text = "لعبت السيدات أدوارًا مهمة في الثقافة والدين، حيث ارتبطن بالحظ والحب والخصوبة والنبوءة."
output = pipe(text)
```

في دفتر الملاحظات، يمكننا استخدام مقتطف الكود التالي للاستماع إلى النتيجة:

```python
from IPython.display import Audio

Audio(output["audio"], rate=output["sampling_rate"])
```

النموذج الذي نستخدمه مع خط الأنابيب، Bark، هو في الواقع متعدد اللغات، لذلك يمكننا بسهولة استبدال النص الأولي بنص باللغة الفرنسية، على سبيل المثال، واستخدام خط الأنابيب بنفس الطريقة تمامًا. سوف يلتقط اللغة بمفرده:

```python
fr_text = "Contrairement à une idée répandue، le nombre de points sur les élytres d'une coccinelle ne correspond pas à son âge، ni en nombre d'années، ni en nombre de mois."
output = pipe(fr_text)
Audio(output["audio"], rate=output["sampling_rate"])
```

لا يقتصر هذا النموذج على كونه متعدد اللغات، بل يمكنه أيضًا توليد صوت لاتصالات غير لفظية وغناء. إليك كيفية جعله يغني:

```python
song = "♪ In the jungle, the mighty jungle, the ladybug was seen. ♪"
output = pipe(song)
Audio(output["audio"], rate=output["sampling_rate"])
```

سنغوص بشكل أعمق في تفاصيل Bark في الوحدة اللاحقة المخصصة للنص إلى كلام، وسنظهر أيضًا كيفية استخدام نماذج أخرى لهذه المهمة. الآن، دعونا نولد بعض الموسيقى!

## توليد الموسيقى

تمامًا كما هو الحال من قبل، سنبدأ بتهيئة خط أنابيب. بالنسبة لتوليد الموسيقى، سنقوم بتعريف خط أنابيب النص إلى الصوت، ونبدأه بنقطة التحقق المسبقة [`facebook/musicgen-small`](https://huggingface.co/facebook/musicgen-small):

```python
music_pipe = pipeline("text-to-audio", model="facebook/musicgen-small")
```

دعونا نقوم بإنشاء وصف نصي للموسيقى التي نود توليدها:

```python
text = "أغنية روك من التسعينيات مع غيتار كهربائي وطبل ثقيل"
```

يمكننا التحكم في طول الإخراج المولد عن طريق تمرير معلمة `max_new_tokens` إضافية إلى النموذج.

```python
forward_params = {"max_new_tokens": 512}

output = music_pipe(text, forward_params=forward_params)
Audio(output["audio"][0], rate=output["sampling_rate"])
```