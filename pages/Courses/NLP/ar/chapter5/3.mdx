## ุญุงู ููุช ุงูุชูุทูุน ูุงูุชูุณูู

ูู ูุนุธู ุงูุฃุญูุงูุ ูู ุชููู ุงูุจูุงูุงุช ุงูุชู ุชุนูู ุนูููุง ุฌุงูุฒุฉ ุชูุงููุง ูุชุฏุฑูุจ ุงูููุงุฐุฌ. ูู ูุฐุง ุงููุณูุ ุณูุณุชูุดู ุงูููุฒุงุช ุงููุฎุชููุฉ ุงูุชู ุชููุฑูุง ููุชุจุฉ ๐ค Datasets ูุชูุธูู ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู.

## ุชูุทูุน ุจูุงูุงุชูุง ูุชูุทูุนูุง

ุชุดุจู ููุชุจุฉ ๐ค Datasets ููุชุจุฉ ุจุงูุฏุงุณุ ุญูุซ ุชููุฑ ุนุฏุฉ ุฏูุงู ููุชุนุงูู ูุน ูุญุชููุงุช ูุงุฆูุงุช "Dataset" ู"DatasetDict". ููุฏ ุชุนุฑููุง ุจุงููุนู ุนูู ุฏุงูุฉ "Dataset.map()" ูู [ุงููุตู 3](/course/chapter3)ุ ููู ูุฐุง ุงููุณูุ ุณูุณุชูุดู ุจุนุถ ุงูุฏูุงู ุงูุฃุฎุฑู ุงููุชุงุญุฉ ููุง.

ุจุงููุณุจุฉ ููุฐุง ุงููุซุงูุ ุณูุณุชุฎุฏู [ูุฌููุนุฉ ุจูุงูุงุช ูุฑุงุฌุนุฉ ุงูุฃุฏููุฉ](https://archive.ics.uci.edu/ml/datasets/Drug+Review+Dataset+%28Drugs.com%29) ุงููุชููุฑุฉ ุนูู [ูุณุชูุฏุน ุชุนูู ุงูุขูุฉ ุงูุชุงุจุน ูุฌุงูุนุฉ ูุงููููุฑููุง ูู ุฅุฑูุงูู](https://archive.ics.uci.edu/ml/index.php)ุ ูุงูุชู ุชุญุชูู ุนูู ูุฑุงุฌุนุงุช ุงููุฑุถู ุญูู ุฃุฏููุฉ ูุฎุชููุฉุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุญุงูุฉ ุงูุชู ูุชู ุนูุงุฌูุง ูุชูููู ูู 10 ูุฌูู ููุฏู ุฑุถุง ุงููุฑูุถ.

ุฃููุงูุ ูุญุชุงุฌ ุฅูู ุชูุฒูู ูุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุชุ ููููู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู ุฃูุฑู "wget" ู"unzip":

```py
!wget "https://archive.ics.uci.edu/ml/machine-learning-databases/00462/drugsCom_raw.zip"
!unzip drugsCom_raw.zip
```

ูุธุฑูุง ูุฃู TSV ูู ูุฌุฑุฏ ูุชุบูุฑ ูู CSV ูุณุชุฎุฏู ุนูุงูุงุช ุงูุชุจููุจ ุจุฏูุงู ูู ุงูููุงุตู ููุงุตูุ ูููููุง ุชุญููู ูุฐู ุงููููุงุช ุจุงุณุชุฎุฏุงู ุจุฑูุงูุฌ ุงูุชุญููู ุงููุตู "csv" ูุชุญุฏูุฏ ูุณูุท "delimiter" ูู ุฏุงูุฉ "load_dataset()" ููุง ููู:

```py
from datasets import load_dataset

data_files = {"train": "drugsComTrain_raw.tsv", "test": "drugsComTest_raw.tsv"}
# \t is the tab character in Python
drug_dataset = load_dataset("csv", data_files=data_files, delimiter="\t")
```

ูู ุงูููุงุฑุณุงุช ุงูุฌูุฏุฉ ุนูุฏ ุฅุฌุฑุงุก ุฃู ููุน ูู ุชุญููู ุงูุจูุงูุงุช ุฃุฎุฐ ุนููุฉ ุนุดูุงุฆูุฉ ุตุบูุฑุฉ ููุญุตูู ุนูู ููุฑุฉ ุณุฑูุนุฉ ุนู ููุน ุงูุจูุงูุงุช ุงูุชู ูุชุนุงูู ูุนูุง. ูู ๐ค Datasetsุ ูููููุง ุฅูุดุงุก ุนููุฉ ุนุดูุงุฆูุฉ ุนู ุทุฑูู ุฑุจุท ุฏุงูุชูู "Dataset.shuffle()" ู"Dataset.select()" ูุนูุง:

```py
drug_sample = drug_dataset["train"].shuffle(seed=42).select(range(1000))
# ูููู ูุธุฑุฉ ุนูู ุงูุฃูุซูุฉ ุงูุฃููู
drug_sample[:3]
```

```python out
{'Unnamed: 0': [87571, 178045, 80482],
'drugName': ['Naproxen', 'Duloxetine', 'Mobic'],
'condition': ['Gout, Acute', 'ibromyalgia', 'Inflammatory Conditions'],
'review': ['"like the previous person mention, I&#039;m a strong believer of aleve, it works faster for my gout than the prescription meds I take. No more going to the doctor for refills.....Aleve works!"',
'"I have taken Cymbalta for about a year and a half for fibromyalgia pain. It is great\r\nas a pain reducer and an anti-depressant, however, the side effects outweighed \r\nany benefit I got from it. I had trouble with restlessness, being tired constantly,\r\ndizziness, dry mouth, numbness and tingling in my feet, and horrible sweating. I am\r\nbeing weaned off of it now. Went from 60 mg to 30mg and now to 15 mg. I will be\r\noff completely in about a week. The fibro pain is coming back, but I would rather deal with it than the side effects."',
'"I have been taking Mobic for over a year with no side effects other than an elevated blood pressure.  I had severe knee and ankle pain which completely went away after taking Mobic.  I attempted to stop the medication however pain returned after a few days."'],
'rating': [9.0, 3.0, 10.0],
'date': ['September 2, 2015', 'November 7, 2011', 'June 5, 2013'],
'usefulCount': [36, 13, 128]}
```

ูุงุญุธ ุฃููุง ุซุจูุชูุง ุงููููุฉ ุงูุงุจุชุฏุงุฆูุฉ ูู ุฏุงูุฉ "Dataset.shuffle()" ูุฃุบุฑุงุถ ุฅุนุงุฏุฉ ุงูุฅูุชุงุฌ. ุชุชููุน ุฏุงูุฉ "Dataset.select()" ูุณูุทูุง ูุงุจููุง ููุชุญุฏูุฏุ ูุฐูู ูุฑุฑูุง "range(1000)" ูุฃุฎุฐ ุฃูู 1000 ูุซุงู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุฎููุทุฉ. ูู ูุฐู ุงูุนููุฉุ ูููููุง ุจุงููุนู ููุงุญุธุฉ ุจุนุถ ุงูุฎุตุงุฆุต ุงูุบุฑูุจุฉ ูู ูุฌููุนุชูุง:

- ูุจุฏู ุงูุนููุฏ "Unnamed: 0" ูุดุจูููุง ูุซู ูุนุฑู ูุฌููู ุงููููุฉ ููู ูุฑูุถ.
- ูุชุถูู ุนููุฏ "condition" ูุฒูุฌูุง ูู ุงูุชุณููุงุช ุงููุจูุฑุฉ ูุงูุตุบูุฑุฉ.
- ุชุฎุชูู ุงููุฑุงุฌุนุงุช ูู ุงูุทูู ูุชุญุชูู ุนูู ูุฒูุฌ ูู ููุงุตู ุงูุฃุณุทุฑ ูู ุจุงูุซูู (`\r\n`) ุจุงูุฅุถุงูุฉ ุฅูู ุฑููุฒ HTML ูุซู `&\#039;`.

ุฏุนููุง ูุฑู ููู ูููููุง ุงุณุชุฎุฏุงู ๐ค Datasets ููุชุนุงูู ูุน ูู ูู ูุฐู ุงููุถุงูุง. ูุงุฎุชุจุงุฑ ูุฑุถูุฉ ูุนุฑู ุงููุฑูุถ ููุนููุฏ "Unnamed: 0"ุ ูููููุง ุงุณุชุฎุฏุงู ุฏุงูุฉ "Dataset.unique()" ููุชุญูู ูู ุฃู ุนุฏุฏ ุงููุนุฑูุงุช ูุทุงุจู ูุนุฏุฏ ุงูุตููู ูู ูู ุชูุณูู:

```py
for split in drug_dataset.keys():
assert len(drug_dataset[split]) == len(drug_dataset[split].unique("Unnamed: 0"))
```

ูุจุฏู ุฃู ูุฐุง ูุคูุฏ ูุฑุถููุชูุงุ ูุฐูู ุฏุนููุง ูููู ุจุชูุธูู ูุฌููุนุฉ ุงูุจูุงูุงุช ููููุงู ุนู ุทุฑูู ุฅุนุงุฏุฉ ุชุณููุฉ ุงูุนููุฏ "Unnamed: 0" ุฅูู ุดูุก ุฃูุซุฑ ูุงุจููุฉ ููููู. ูููููุง ุงุณุชุฎุฏุงู ุฏุงูุฉ "DatasetDict.rename_column()" ูุฅุนุงุฏุฉ ุชุณููุฉ ุงูุนููุฏ ูู ููุง ุงูุชูุณูููู ูู ุฎุทูุฉ ูุงุญุฏุฉ:

```py
drug_dataset = drug_dataset.rename_column(
original_column_name="Unnamed: 0", new_column_
```
## ุงูููู ุงูุฎุงุฑูุฉ ูุทุฑููุฉ `map()`

ุชุฃุฎุฐ ุทุฑููุฉ `Dataset.map()` ูุณูุทูุง `batched` ุงูุฐู ูุชุณุจุจุ ุนูุฏ ุชุนูููู ุฅูู `True`ุ ูู ุฅุฑุณุงู ุฏูุนุฉ ูู ุงูุฃูุซูุฉ ุฅูู ุฏุงูุฉ ุงูุฎุฑูุทุฉ ูุฑุฉ ูุงุญุฏุฉ (ูููู ุชูููู ุญุฌู ุงูุฏูุนุฉ ููููู ูุชุฎุฐ 1000 ุจุดูู ุงูุชุฑุงุถู). ุนูู ุณุจูู ุงููุซุงูุ ุงุณุชุบุฑูุช ุฏุงูุฉ ุงูุฎุฑูุทุฉ ุงูุณุงุจูุฉ ุงูุชู ุฃุฒุงูุช ุฌููุน ุนูุงูุงุช HTML ุจุนุถ ุงูููุช ููุชุดุบูู (ููููู ูุฑุงุกุฉ ุงูููุช ุงููุณุชุบุฑู ูู ุฃุดุฑุทุฉ ุงูุชูุฏู). ูููููุง ุชุณุฑูุน ุฐูู ูู ุฎูุงู ูุนุงูุฌุฉ ุงูุนุฏูุฏ ูู ุงูุนูุงุตุฑ ูู ููุณ ุงูููุช ุจุงุณุชุฎุฏุงู ุชุนุจูุฑ ูุงุฆูุฉ.

ุนูุฏูุง ุชุญุฏุฏ `batched=True`ุ ุชุชููู ุงูุฏุงูุฉ ูุงููุณูุง ุจุญููู ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูููู ูู ูููุฉ ูู ุงูุขู _ูุงุฆูุฉ ูู ุงูููู_ุ ูููุณุช ูููุฉ ูุงุญุฏุฉ ููุท. ูุฌุจ ุฃู ุชููู ุงููููุฉ ุงููุฑุฌุนุฉ ูู `Dataset.map()` ูู ููุณูุง: ูุงููุณ ุจุงูุญูู ุงูุฐู ูุฑูุฏ ุชุญุฏูุซู ุฃู ุฅุถุงูุชู ุฅูู ูุฌููุนุฉ ุงูุจูุงูุงุชุ ููุงุฆูุฉ ูู ุงูููู. ุนูู ุณุจูู ุงููุซุงูุ ุฅููู ุทุฑููุฉ ุฃุฎุฑู ูุฅูุบุงุก ุนูุงูุงุช ุฌููุน ุฃุญุฑู HTMLุ ูููู ุจุงุณุชุฎุฏุงู `batched=True`:

```python
new_drug_dataset = drug_dataset.map(
lambda x: {"review": [html.unescape(o) for o in x["review"]]}, batched=True
)
```

ุฅุฐุง ููุช ุชุดุบู ูุฐุง ุงูููุฏ ูู ุฏูุชุฑ ููุงุญุธุงุชุ ูุณุชูุงุญุธ ุฃู ูุฐุง ุงูุฃูุฑ ูููุฐ ุจุดูู ุฃุณุฑุน ุจูุซูุฑ ูู ุงูุฃูุฑ ุงูุณุงุจู. ูููุณ ูุฃู ูุฑุงุฌุนุงุชูุง ุชูุช ุฅุฒุงูุฉ ุนูุงูุงุช HTML ูููุง ุจุงููุนู - ุฅุฐุง ููุช ุจุชูููุฐ ุงูุชุนูููุงุช ูู ุงููุณู ุงูุณุงุจู ูุฑุฉ ุฃุฎุฑู (ุจุฏูู `batched=True`)ุ ูุณูุณุชุบุฑู ููุณ ุงูููุช ุงูุณุงุจู. ููุฑุฌุน ุฐูู ุฅูู ุฃู ุชุนุจูุฑุงุช ุงูููุงุฆู ุชููู ุนุงุฏุฉู ุฃุณุฑุน ูู ุชูููุฐ ููุณ ุงูููุฏ ูู ุญููุฉ `for`ุ ูููุชุณุจ ุฃูุถูุง ุจุนุถ ุงูุฃุฏุงุก ุนู ุทุฑูู ุงููุตูู ุฅูู ุงูุนุฏูุฏ ูู ุงูุนูุงุตุฑ ูู ููุณ ุงูููุช ุจุฏูุงู ูู ูุงุญุฏ ุชูู ุงูุขุฎุฑ.

ุณูุนุฏ ุงุณุชุฎุฏุงู `Dataset.map()` ูุน `batched=True` ุฃูุฑูุง ุฃุณุงุณููุง ููุชุญ ุณุฑุนุฉ "ุงููุญูู ุงูุจุฑูุฌู ุงูุณุฑูุน" ุงูุชู ุณูุตุงุฏููุง ูู [ุงููุตู 6](/course/chapter6)ุ ูุงูุชู ูููููุง ุชุญููู ููุงุฆู ุงููุตูุต ุงููุจูุฑุฉ ุจุณุฑุนุฉ. ุนูู ุณุจูู ุงููุซุงูุ ูุชุญููู ุฌููุน ูุฑุงุฌุนุงุช ุงูุฃุฏููุฉ ุจุงุณุชุฎุฏุงู ูุญูู ุจุฑูุฌู ุณุฑูุนุ ูููููุง ุงุณุชุฎุฏุงู ุฏุงูุฉ ูุซู ูุฐู:

```python
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("bert-base-cased")


def tokenize_function(examples):
return tokenizer(examples["review"], truncation=True)
```

ููุง ุฑุฃูุช ูู [ุงููุตู 3](/course/chapter3)ุ ูููููุง ุชูุฑูุฑ ูุซุงู ูุงุญุฏ ุฃู ุฃูุซุฑ ุฅูู ุงููุญูู ุงูุจุฑูุฌูุ ูุฐุง ูููููุง ุงุณุชุฎุฏุงู ูุฐู ุงูุฏุงูุฉ ูุน ุฃู ุจุฏูู `batched=True`. ุฏุนููุง ูุบุชูู ูุฐู ุงููุฑุตุฉ ูููุงุฑูุฉ ุฃุฏุงุก ุงูุฎูุงุฑุงุช ุงููุฎุชููุฉ. ูู ุฏูุชุฑ ุงูููุงุญุธุงุชุ ููููู ุชูููุช ุชุนูููุงุช ูู ุณุทุฑ ูุงุญุฏ ุนู ุทุฑูู ุฅุถุงูุฉ `%time` ูุจู ุณุทุฑ ุงูููุฏ ุงูุฐู ุชุฑูุฏ ููุงุณู:

```python no-format
%time tokenized_dataset = drug_dataset.map(tokenize_function, batched=True)
```

ููููู ุฃูุถูุง ุชูููุช ุฎููุฉ ูุงููุฉ ุนู ุทุฑูู ูุถุน `%%time` ูู ุจุฏุงูุฉ ุงูุฎููุฉ. ุนูู ุงูุฃุฌูุฒุฉ ุงูุชู ูููุง ุจุชูููุฐูุง ุนูููุงุ ุฃุธูุฑุช 10.8 ุซุงููุฉ ููุฐุง ุงูุฃูุฑ (ูู ุงูุฑูู ุงูููุชูุจ ุจุนุฏ "Wall time").

<Tip>

โ๏ธ **ุฌุฑุจู!** ููุฐ ููุณ ุงูุฃูุฑ ูุน ูุจุฏูู `batched=True`ุ ุซู ุฌุฑุจู ุจุงุณุชุฎุฏุงู ูุญูู ุจุฑูุฌู ุจุทูุก (ุฃุถู `use_fast=False` ูู ุทุฑููุฉ `AutoTokenizer.from_pretrained()`) ุญุชู ุชุชููู ูู ุฑุคูุฉ ุงูุฃุฑูุงู ุงูุชู ุชุญุตู ุนูููุง ุนูู ุฃุฌูุฒุชู.

</Tip>

ูููุง ููู ุงููุชุงุฆุฌ ุงูุชู ุญุตููุง ุนูููุง ุจุงุณุชุฎุฏุงู ุงูุฏูุนุงุช ูุนุฏู ุงุณุชุฎุฏุงููุงุ ุจุงุณุชุฎุฏุงู ูุญูู ุจุฑูุฌู ุณุฑูุน ูุจุทูุก:

ุงูุฎูุงุฑุงุช | ุงููุญูู ุงูุจุฑูุฌู ุงูุณุฑูุน | ุงููุญูู ุงูุจุฑูุฌู ุงูุจุทูุก
:--------------:|:--------------:|:-------------:
`batched=True`  | 10.8 ุซุงููุฉ          | 4 ุฏูุงุฆู ู 41 ุซุงููุฉ
`batched=False` | 59.2 ุซุงููุฉ          | 5 ุฏูุงุฆู ู 3 ุซูุงูู

ูุฐุง ูุนูู ุฃู ุงุณุชุฎุฏุงู ูุญูู ุจุฑูุฌู ุณุฑูุน ูุน ุฎูุงุฑ `batched=True` ุฃุณุฑุน 30 ูุฑุฉ ูู ูุธูุฑู ุงูุจุทูุก ุจุฏูู ุฏูุนุงุช - ููุฐุง ุฃูุฑ ุฑุงุฆุน ุญููุง! ูุฐุง ูู ุงูุณุจุจ ุงูุฑุฆูุณู ูู ุฃู ุงููุญููุงุช ุงูุจุฑูุฌูุฉ ุงูุณุฑูุนุฉ ูู ุงูุงูุชุฑุงุถูุฉ ุนูุฏ ุงุณุชุฎุฏุงู `AutoTokenizer` (ูุงูุณุจุจ ูู ุชุณููุชูุง "ุณุฑูุนุฉ"). ุฅููู ูุงุฏุฑูู ุนูู ุชุญููู ูุซู ูุฐุง ุงูุชุณุฑูุน ูุฃู ููุฏ ุงููุญูู ุงูุจุฑูุฌู ูุชู ุชูููุฐู ูู Rust ุฎูู ุงูููุงููุณุ ููู ูุบุฉ ุชุฌุนู ูู ุงูุณูู ููุงุฒุงุฉ ุชูููุฐ ุงูููุฏ.

ุงูููุงุฒุงุฉ ูู ุฃูุถูุง ุณุจุจ ุชุญููู ุงููุญูู ุงูุจุฑูุฌู ุงูุณุฑูุน ูุณุฑุนุฉ 6 ูุฑุงุช ุชูุฑูุจูุง ุจุงุณุชุฎุฏุงู ุงูุฏูุนุงุช: ูุง ููููู ููุงุฒุงุฉ ุนูููุฉ ุชุญููู ุจุฑูุฌู ูุงุญุฏุฉุ ูููู ุนูุฏูุง ุชุฑูุฏ ุชุญููู ุงูุนุฏูุฏ ูู ุงููุตูุต ูู ููุณ ุงูููุชุ ููููู ุจุจุณุงุทุฉ ุชูุณูู ุงูุชูููุฐ ุนุจุฑ ุนุฏุฉ ุนูููุงุชุ ููู ูููุง ูุณุคูู ุนู ูุตูุตู ุงูุฎุงุตุฉ.

ุชุชูุชุน ุทุฑููุฉ `Dataset.map()` ุฃูุถูุง ุจุจุนุถ ูุฏุฑุงุช ุงูููุงุฒุงุฉ ุงูุฎุงุตุฉ ุจูุง. ูุธุฑูุง ูุฃููุง ูุง ุชุนุชูุฏ ุนูู Rustุ ููู ุชุณูุญ ููุญูู ุจุฑูุฌู ุจุทูุก ุจุงููุญุงู ุจูุญูู ุจุฑูุฌู ุณุฑูุนุ ูููููุง ูุฏ ุชููู ูููุฏุฉ (ุฎุงุตุฉ ุฅุฐุง ููุช ุชุณุชุฎุฏู ูุญูููุง ุจุฑูุฌููุง ูุง ูุญุชูู ุนูู ุฅุตุฏุงุฑ ุณุฑูุน). ูุชูููู ุงููุนุงูุฌุฉ ุงููุชุนุฏุฏุฉุ ุงุณุชุฎุฏู ูุณูุท `num_proc` ูุญุฏุฏ ุนุฏุฏ ุงูุนูููุงุช ุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุง ูู ููุงููุฉ `Dataset.map()` ุงูุฎุงุตุฉ ุจู:

```py
slow_tokenizer = AutoTokenizer.from_pretrained("bert-base-cased", use_fast=False)


def slow_tokenize_function(examples):
return slow_tokenizer(examples["review"], truncation=True)


tokenized_dataset = drug_dataset.map(slow_tokenize_function, batched=True, num_proc=8)
```

ููููู ุฅุฌุฑุงุก ุจุนุถ ุงูุชุฌุงุฑุจ ูุน ุงูุชูููุช ูุชุญุฏูุฏ ุงูุนุฏุฏ ุงูุฃูุซู ูู ุงูุนูููุงุช ุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุงุ ูู ุญุงูุชูุงุ ุจุฏุง ุฃู 8 ุญููุช ุฃูุถู ููุณุจ ูู ุงูุณุฑุนุฉ. ูููุง ููู ุงูุฃุฑูุงู ุงูุชู ุญุตููุง ุนูููุง ูุน ุงููุนุงูุฌุฉ ุงููุชุนุฏุฏุฉ ูุจุฏูููุง:

ุงูุฎูุงุฑุงุช | ุงููุญูู ุงูุจุฑูุฌู ุงูุณุฑูุน | ุงููุญูู ุงูุจุฑูุฌู ุงูุจุทูุก
:--------------:|:--------------:|:-------------:
`batched=True`  | 10.8 ุซุงููุฉ          | 4 ุฏูุงุฆู ู 41 ุซุงููุฉ
`batched=False` | 59.2 ุซุงููุฉ          | 5 ุฏูุงุฆู ู 3 ุซูุงูู
`batched=True`ุ `num_proc=8`  | 6.52 ุซุงููุฉ          | 41.3 ุซุงููุฉ
`batched=False`ุ `num_proc=8` | 9.49 ุซุงููุฉ          | 45.2 ุซุงููุฉ

ุชูู ูู ูุชุงุฆุฌ ุฃูุซุฑ ููุทููุฉ ูููุญูู ุงูุจุฑูุฌู ุงูุจุทูุกุ ูููู ุชู ุฃูุถูุง ุชุญุณูู ุฃุฏุงุก ุงููุญูู ุงูุจุฑูุฌู ุงูุณุฑูุน ุจุดูู ูุจูุฑ. ูุงุญุธุ ูุน ุฐููุ ุฃู ูุฐุง ูู ูููู ูู ุงูุญุงู ุฏุงุฆููุง - ุจุงููุณุจุฉ ูููู `num_proc` ุงูุฃุฎุฑู ุบูุฑ 8ุ ุฃุธูุฑุช ุงุฎุชุจุงุฑุงุชูุง ุฃูู ูุงู ูู ุงูุฃุณุฑุน ุงุณุชุฎุฏุงู `batched=True` ุจุฏูู ูุฐุง ุงูุฎูุงุฑ. ุจุดูู ุนุงูุ ูุง ููุตู ุจุงุณุชุฎุฏุงู ุงููุนุงูุฌุฉ ุงููุชุนุฏุฏุฉ ูู Python ููุญููุงุช ุจุฑูุฌูุฉ ุณุฑูุนุฉ ูุน `batched=True`.

<Tip>

ูุนุฏ ุงุณุชุฎุฏุงู `num_proc` ูุฒูุงุฏุฉ ุณุฑุนุฉ ูุนุงูุฌุชู ููุฑุฉ ุฑุงุฆุนุฉุ ุทุงููุง ุฃู ุงูุฏุงูุฉ ุงูุชู ุชุณุชุฎุฏููุง ูุง ุชููู ุจุงููุนู ุจุจุนุถ ุฃููุงุน ุงููุนุงูุฌุฉ ุงููุชุนุฏุฏุฉ ุงูุฎุงุตุฉ ุจูุง.

</Tip>

ูู ูุฐู ุงููุธุงุฆู ุงูููุซูุฉ ูู ุทุฑููุฉ ูุงุญุฏุฉ ุฃูุฑ ุฑุงุฆุน ุจุงููุนูุ ูููู ููุงู ุงููุฒูุฏ! ุจุงุณุชุฎุฏุงู `Dataset.map()` ู `batched=True`ุ ููููู ุชุบููุฑ ุนุฏุฏ ุงูุนูุงุตุฑ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู. ูุฐุง ูููุฏ ููุบุงูุฉ ูู ุงูุนุฏูุฏ ูู ุงูููุงูู ุงูุชู ุชุฑูุฏ ูููุง ุฅูุดุงุก ุงูุนุฏูุฏ ูู ููุฒุงุช ุงูุชุฏุฑูุจ ูู ูุซุงู ูุงุญุฏุ ูุณูุญุชุงุฌ ุฅูู ุงูููุงู ุจุฐูู ูุฌุฒุก ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุณุจูุฉ ูุนุฏุฉ ููุงู NLP ุงูุชู ุณูููู ุจูุง ูู [ุงููุตู 7](/course/chapter7).

<Tip>

๐ก ูู ุงูุชุนูู ุงูุขููุ ูุชู ุชุนุฑูู _ุงููุซุงู_ ุนุงุฏุฉู ุนูู ุฃูู ูุฌููุนุฉ ูู _ุงูููุฒุงุช_ ุงูุชู ูููู ุจุชุบุฐูุชูุง ุจุงููููุฐุฌ. ูู ุจุนุถ ุงูุณูุงูุงุชุ ุณุชููู ูุฐู ุงูููุฒุงุช ูู ูุฌููุนุฉ ุงูุฃุนูุฏุฉ ูู `Dataset`ุ ูููู ูู ุณูุงูุงุช ุฃุฎุฑู (ูุซู ููุง ูููุฅุฌุงุจุฉ ุนูู ุงูุฃุณุฆูุฉ)ุ ูููู ุงุณุชุฎุฑุงุฌ ููุฒุงุช ูุชุนุฏุฏุฉ ูู ูุซุงู ูุงุญุฏ ูุชูุชูู ุฅูู ุนููุฏ ูุงุญุฏ.

</Tip>

ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููููุฉ ุนููู! ููุง ุณูููู ุจุชุญููู ุงูุฃูุซูุฉ ุงูุฎุงุตุฉ ุจูุง ูุชูููุตูุง ุฅูู ุทูู ุฃูุตู ูุจูุบ 128ุ ูููููุง ุณูุทูุจ ูู ุงููุญูู ุงูุจุฑูุฌู ุฅุนุงุฏุฉ *ุฌููุน* ุฃุฌุฒุงุก ุงููุตูุต ุจุฏูุงู ูู ุงูุฌุฒุก ุงูุฃูู ููุท. ูููู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู `return_overflowing_tokens=True`:

```py
def tokenize_and_split(examples):
return tokenizer(
examples["review"],
truncation=True,
max_length=128,
return_overflowing_tokens=True,
)
```

ุฏุนููุง ูุฎุชุจุฑ ูุฐุง ุนูู ูุซุงู ูุงุญุฏ ูุจู ุงุณุชุฎุฏุงู `Dataset.map()` ุนูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุฃููููุง:

```py
result = tokenize_and_split(drug_dataset["train"][0])
[len(inp) for inp in result["input_ids"]]
```

```python out
[128ุ 49]
```

ูุฐุงุ ุฃุตุจุญ ูุซุงููุง ุงูุฃูู ูู ูุฌููุนุฉ ุงูุชุฏุฑูุจ ููุฒุชูู ูุฃูู ุชู ุชุญูููู ุฅูู ุฃูุซุฑ ูู ุงูุนุฏุฏ ุงูุฃูุตู ูู ุงูุฑููุฒ ุงูุชู ุญุฏุฏูุงูุง: ุงูุฃูู ุจุทูู 128 ูุงูุซุงูู ุจุทูู 49. ุงูุขู ุฏุนููุง ููุนู ูุฐุง ูุฌููุน ุนูุงุตุฑ ูุฌููุนุฉ ุงูุจูุงูุงุช!

```py
tokenized_dataset = drug_dataset.map(tokenize_and_split, batched=True)
```

```python out
ArrowInvalid: ุชู ุชููุน ุทูู 1463 ููุนููุฏ 1 ุงููุณูู condition ูููู ุชู ุงูุญุตูู ุนูู ุทูู 1000
```

ูุง ุฅููู! ููุงุฐุง ูู ููุฌุญ ุฐููุ ุฅู ุฅููุงุก ูุธุฑุฉ ุนูู ุฑุณุงูุฉ ุงูุฎุทุฃ ุณูุนุทููุง ุชูููุญูุง: ููุงู ุนุฏู ุชุทุงุจู ูู ุฃุทูุงู ุฃุญุฏ ุงูุฃุนูุฏุฉุ ุฃุญุฏููุง ูุจูุบ ุทููู 1463 ูุงูุขุฎุฑ ูุจูุบ ุทููู 1000. ุฅุฐุง ููุช ูุฏ ุงุทูุนุช ุนูู ูุซุงุฆู `Dataset.map()` [documentation](https://huggingface.co/docs/datasets/package_reference/main_classes#datasets.Dataset.map)ุ ูุฑุจูุง ุชุชุฐูุฑ ุฃูู ุนุฏุฏ ุงูุนููุงุช ุงูุชู ุชู ุชูุฑูุฑูุง ุฅูู ุงูุฏุงูุฉ ุงูุชู ูููู ุจุชุนููู ุงูุฎุฑูุทุฉ ููุงุ ููุง ุฃุนุทุช ูุฐู ุงูุนููุงุช ุงูุจุงูุบ ุนุฏุฏูุง 1000 ููุฒุงุช ุฌุฏูุฏุฉ ูุจูุบ ุนุฏุฏูุง 1463ุ ููุง ุฃุฏู ุฅูู ุฎุทุฃ ูู ุงูุดูู.

ุงููุดููุฉ ูู ุฃููุง ูุญุงูู ูุฒุฌ ูุฌููุนุชูู ูู ุงูุจูุงูุงุช ุงููุฎุชููุฉ ุงูุฃุญุฌุงู: ุณูููู ูุฃุนูุฏุฉ `drug_dataset` ุนุฏุฏูุง ูุนูููุง ูู ุงูุฃูุซูุฉ (1000 ูู ุฎุทุฃูุง)ุ ูููู ุณูููู ููุฌููุนุฉ ุงูุจูุงูุงุช `tokenized_dataset` ุงูุชู ูุจูููุง ุงููุฒูุฏ (1463 ูู ุฑุณุงูุฉ ุงูุฎุทุฃุ ููู ุฃูุซุฑ ูู 1000 ูุฃููุง ูููู ุจุชุญููู ุงููุฑุงุฌุนุงุช ุงูุทูููุฉ ุฅูู ุฃูุซุฑ ูู ูุซุงู ูุงุญุฏ ุจุงุณุชุฎุฏุงู `return_overflowing_tokens=True`). ูุฐุง ูุง ูุนูู ููุฌููุนุฉ ุจูุงูุงุชุ ูุฐูู ูุญุชุงุฌ ุฅูู ุฅูุง ุฅุฒุงูุฉ ุงูุฃุนูุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ ุฃู ุฌุนููุง ุจููุณ ุงูุญุฌู ููุง ูู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ. ูููููุง ุงูููุงู ุจุงูุฃูู ุจุงุณุชุฎุฏุงู ูุณูุท `remove_columns`:

```py
tokenized_dataset = drug_dataset.map(
tokenize_and_split, batched=True, remove_columns=drug_dataset["train"].column_names
)
```

ุงูุขู ูุนูู ูุฐุง ุจุฏูู ุฎุทุฃ. ูููููุง ุงูุชุญูู ูู ุฃู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูุฏููุง ุชุญุชูู ุนูู ุนูุงุตุฑ ุฃูุซุฑ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฃุตููุฉ ุนู ุทุฑูู ููุงุฑูุฉ ุงูุฃุทูุงู:

```py
len(tokenized_dataset["train"]), len(drug_dataset["train"])
```

```python out
(206772ุ 138514)
```

ููุฏ ุฐูุฑูุง ุฃูู ูููููุง ุฃูุถูุง ุงูุชุนุงูู ูุน ูุดููุฉ ุนุฏู ุชุทุงุจู ุงูุทูู ุนู ุทุฑูู ุฌุนู ุงูุฃุนูุฏุฉ ุงููุฏููุฉ ุจููุณ ุญุฌู ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ. ููููุงู ุจุฐููุ ุณูุญุชุงุฌ ุฅูู ุญูู `overflow_to_sample_mapping` ุงูุฐู ูุนูุฏู ุงููุญูู ุงูุจุฑูุฌู ุนูุฏ ุชุนููููุง `return_overflowing_tokens=True`. ููู ูุนุทููุง ุฎุฑูุทุฉ ูู ููุฑุณ ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ ุฅูู ููุฑุณ ุงูุนููุฉ ุงูุชู ูุดุฃุช ูููุง. ุจุงุณุชุฎุฏุงู ูุฐุงุ ูููููุง ุฑุจุท ูู ููุชุงุญ ููุฌูุฏ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฃุตููุฉ ุจูุงุฆูุฉ ูู ุงูููู ุจุงูุญุฌู ุงูุตุญูุญ ุนู ุทุฑูู ุชูุฑุงุฑ ููู ูู ูุซุงู ุจูุฏุฑ ูุง ููุดุฆ ููุฒุงุช ุฌุฏูุฏุฉ:

```py
def tokenize_and_split(examples):
result = tokenizer(
examples["review"],
truncation=True,
max_length=128,
return_overflowing_tokens=True,
)
# ุงุณุชุฎุฑุงุฌ ุงูุฎุฑูุทุฉ ุจูู ุงูููุงุฑุณ ุงูุฌุฏูุฏุฉ ูุงููุฏููุฉ
sample_map = result.pop("overflow_to_sample_mapping")
for key, values in examples.items():
result[key] = [values[i] for i in sample_map]
return result
```

ูููููุง ุฑุคูุฉ ุฃูู ูุนูู ูุน `Dataset.map()` ุฏูู ุงูุญุงุฌุฉ ุฅูู ุฅุฒุงูุฉ ุงูุฃุนูุฏุฉ ุงููุฏููุฉ:

```py
tokenized_dataset = drug_dataset.map(tokenize_and_split, batched=True)
tokenized_dataset
```

```python out
DatasetDict({
train: Dataset({
features: ['attention_mask'ุ 'condition'ุ 'date'ุ 'drugName'ุ 'input_ids'ุ 'patient_id'ุ 'rating'ุ 'review'ุ 'review_length'ุ 'token_type_ids'ุ 'usefulCount']ุ
num_rows: 206772
})
test: Dataset({
features: ['attention_mask'ุ 'condition'ุ 'date'ุ 'drugName'ุ 'input_ids'ุ 'patient_id'ุ 'rating'ุ 'review'ุ 'review_length'ุ 'token_type_ids'ุ 'usefulCount']ุ
num_rows: 68876
})
})
```

ูุญุตู ุนูู ููุณ ุนุฏุฏ ููุฒุงุช ุงูุชุฏุฑูุจ ููุง ูุงู ูู ูุจูุ ูููู ููุง ุงุญุชูุธูุง ุจุฌููุน ุงูุญููู ุงููุฏููุฉ. ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูููุง ููุจุนุถ ุจุนุฏ ุชุทุจูู ูููุฐุฌูุ ููุฏ ุชุฑุบุจ ูู ุงุณุชุฎุฏุงู ูุฐุง ุงูููุฌ.

ููุฏ ุฑุฃูุช ุงูุขู ููู ูููู ุงุณุชุฎุฏุงู ูุฌููุนุงุช ุงูุจูุงูุงุช ๐ค ููุนุงูุฌุฉ ูุฌููุนุฉ ุจูุงูุงุช ุจุทุฑู ูุฎุชููุฉ. ุนูู ุงูุฑุบู ูู ุฃู ูุธุงุฆู ุงููุนุงูุฌุฉ ูู ูุฌููุนุงุช ุงูุจูุงูุงุช ๐ค ุณุชุบุทู ูุนุธู ุงุญุชูุงุฌุงุช ุชุฏุฑูุจ ุงููููุฐุฌ ุงูุฎุงุต ุจูุ ููุฏ ุชููู ููุงู ุฃููุงุช ุชุญุชุงุฌ ูููุง ุฅูู ุงูุชุจุฏูู ุฅูู Pandas ูููุตูู ุฅูู ููุฒุงุช ุฃูุซุฑ ููุฉุ ูุซู `DataFrame.groupby()` ุฃู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุนุงููุฉ ุงููุณุชูู ููุชุตูุฑ. ูุญุณู ุงูุญุธุ ุชู ุชุตููู ูุฌููุนุงุช ุงูุจูุงูุงุช ๐ค ูุชููู ูุชูุงููุฉ ูุน ุงูููุชุจุงุช ูุซู Pandas ู NumPy ู PyTorch ู TensorFlow ู JAX. ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููููุฉ ุนูู ุฐูู.
## ูู `Dataset`s ุฅูู `DataFrame`s ูุงูุฑุฌูุน [[from-datasets-to-dataframes-and-back]]

<Youtube id="tfcY1067A5Q"/>

ูุชุณููู ุงูุชุญููู ุจูู ูุฎุชูู ุงูููุชุจุงุช ุงูุฎุงุฑุฌูุฉุ ุชููุฑ ููุชุจุฉ ๐ค Datasets ุฏุงูุฉ `Dataset.set_format()`. ุชููู ูุฐู ุงูุฏุงูุฉ ููุท ุจุชุบููุฑ ุชูุณูู ุงูุฅุฎุฑุงุฌ ูููุฌููุนุฉ ุงูุจูุงูุงุชุ ุจุญูุซ ููููู ุงูุชุจุฏูู ุจุณูููุฉ ุฅูู ุชูุณูู ุขุฎุฑ ุฏูู ุงูุชุฃุซูุฑ ุนูู ุชูุณูู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุ ูุงูุฐู ูู Apache Arrow. ูุชู ุงูุชูุณูู ูู ุงูููุงู. ูููุชูุถูุญุ ุฏุนููุง ูุญูู ูุฌููุนุชูุง ุงูุจูุงูุงุช ุฅูู Pandas:

```py
drug_dataset.set_format("pandas")
```

ุงูุขู ุนูุฏูุง ูุตู ุฅูู ุนูุงุตุฑ ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูุญุตู ุนูู `pandas.DataFrame` ุจุฏูุงู ูู ูุงููุณ:

```py
drug_dataset["train"][:3]
```

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>patient_id</th>
<th>drugName</th>
<th>condition</th>
<th>review</th>
<th>rating</th>
<th>date</th>
<th>usefulCount</th>
<th>review_length</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>95260</td>
<td>Guanfacine</td>
<td>adhd</td>
<td>"My son is halfway through his fourth week of Intuniv..."</td>
<td>8.0</td>
<td>April 27, 2010</td>
<td>192</td>
<td>141</td>
</tr>
<tr>
<th>1</th>
<td>92703</td>
<td>Lybrel</td>
<td>birth control</td>
<td>"I used to take another oral contraceptive, which had 21 pill cycle, and was very happy- very light periods, max 5 days, no other side effects..."</td>
<td>5.0</td>
<td>December 14, 2009</td>
<td>17</td>
<td>134</td>
</tr>
<tr>
<th>2</th>
<td>138000</td>
<td>Ortho Evra</td>
<td>birth control</td>
<td>"This is my first time using any form of birth control..."</td>
<td>8.0</td>
<td>November 3, 2015</td>
<td>10</td>
<td>89</td>
</tr>
</tbody>
</table>

ุฏุนููุง ููุดุฆ `pandas.DataFrame` ููุฌููุนุฉ ุงูุชุฏุฑูุจ ุงููุงููุฉ ุนู ุทุฑูู ุชุญุฏูุฏ ุฌููุน ุนูุงุตุฑ `drug_dataset["train"]`:

```py
train_df = drug_dataset["train"][:]
```

<Tip>

๐จ ุชุญุช ุงูุบุทุงุกุ ุชุบูุฑ ุฏุงูุฉ `Dataset.set_format()` ุชูุณูู ุงูุฅุฑุฌุงุน ูุทุฑููุฉ `__getitem__` ุงูุฎุงุตุฉ ุจูุฌููุนุฉ ุงูุจูุงูุงุช. ููุฐุง ูุนูู ุฃูู ุนูุฏูุง ูุฑูุฏ ุฅูุดุงุก ูุงุฆู ุฌุฏูุฏ ูุซู `train_df` ูู `Dataset` ุจุชูุณูู "pandas"ุ ูุชุนูู ุนูููุง ุชูุณูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุงููุงูู ููุญุตูู ุนูู `pandas.DataFrame`. ููููู ุงูุชุญูู ุจููุณู ูู ุฃู ููุน `drug_dataset["train"]` ูู `Dataset`ุ ุจุบุถ ุงููุธุฑ ุนู ุชูุณูู ุงูุฅุฎุฑุงุฌ.

</Tip>

ูู ููุงุ ูููููุง ุงุณุชุฎุฏุงู ุฌููุน ูุธุงุฆู Pandas ุงูุชู ูุฑูุฏ. ุนูู ุณุจูู ุงููุซุงูุ ูููููุง ุงูููุงู ุจุชุณูุณู ูุนูุฏ ูุญุณุงุจ ุชูุฒูุน ุงููุฆุงุช ุจูู ุฅุฏุฎุงูุงุช "condition":

```py
frequencies = (
train_df["condition"]
.value_counts()
.to_frame()
.reset_index()
.rename(columns={"index": "condition", "condition": "frequency"})
)
frequencies.head()
```

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>condition</th>
<th>frequency</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>birth control</td>
<td>27655</td>
</tr>
<tr>
<th>1</th>
<td>depression</td>
<td>8023</td>
</tr>
<tr>
<th>2</th>
<td>acne</td>
<td>5209</td>
</tr>
<tr>
<th>3</th>
<td>anxiety</td>
<td>4991</td>
</tr>
<tr>
<th>4</th>
<td>pain</td>
<td>4744</td>
</tr>
</tbody>
</table>

ูุจูุฌุฑุฏ ุงูุงูุชูุงุก ูู ุชุญููู Pandasุ ูููููุง ุฏุงุฆููุง ุฅูุดุงุก ูุงุฆู `Dataset` ุฌุฏูุฏ ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `Dataset.from_pandas()` ููุง ููู:

```py
from datasets import Dataset

freq_dataset = Dataset.from_pandas(frequencies)
freq_dataset
```

```python out
Dataset({
features: ['condition', 'frequency'],
num_rows: 819
})
```

<Tip>

โ๏ธ **ุฌุฑุจูุง!** ูู ุจุญุณุงุจ ูุชูุณุท ุงูุชุตููู ููู ุฏูุงุก ููู ุจุชุฎุฒูู ุงููุชูุฌุฉ ูู `Dataset` ุฌุฏูุฏุฉ.

</Tip>

ูุฐุง ูุฎุชุชู ุฌููุชูุง ูู ูุฎุชูู ุชูููุงุช ุงููุนุงูุฌุฉ ุงููุณุจูุฉ ุงููุชุงุญุฉ ูู ๐ค Datasets. ููุฅููุงุก ูุฐุง ุงููุณูุ ุฏุนููุง ููุดุฆ ูุฌููุนุฉ ุจูุงูุงุช ุชุญูู ููุชุฃูุฏ ูู ุฃู ูุฌููุนุฉ ุงูุจูุงูุงุช ุฌุงูุฒุฉ ูุชุฏุฑูุจ ูุตูู ุนูููุง. ูุจู ุงูููุงู ุจุฐููุ ุณูุนูุฏ ุชุนููู ุชูุณูู ุงูุฅุฎุฑุงุฌ ูู `drug_dataset` ูู "pandas" ุฅูู "arrow":

```python
drug_dataset.reset_format()
```

## ุฅูุดุงุก ูุฌููุนุฉ ุงูุชุญูู [[creating-a-validation-set]]

ุนูู ุงูุฑุบู ูู ุฃู ูุฏููุง ูุฌููุนุฉ ุงุฎุชุจุงุฑ ูููููุง ุงุณุชุฎุฏุงููุง ููุชููููุ ุฅูุง ุฃูู ูู ุงูุฌูุฏ ุชุฑู ูุฌููุนุฉ ุงูุงุฎุชุจุงุฑ ุฏูู ุชุบููุฑ ูุฅูุดุงุก ูุฌููุนุฉ ุชุญูู ูููุตูุฉ ุฃุซูุงุก ุงูุชุทููุฑ. ุจูุฌุฑุฏ ุฃู ุชููู ุฑุงุถููุง ุนู ุฃุฏุงุก ููุงุฐุฌู ุนูู ูุฌููุนุฉ ุงูุชุญููุ ููููู ุฅุฌุฑุงุก ูุญุต ููุงุฆู ููุตุญุฉ ุนูู ูุฌููุนุฉ ุงูุงุฎุชุจุงุฑ. ุชุณุงุนุฏ ูุฐู ุงูุนูููุฉ ูู ุงูุชุฎููู ูู ุฎุทุฑ ุงูุฅูุฑุงุท ูู ุงูููุงุกูุฉ ููุฌููุนุฉ ุงูุงุฎุชุจุงุฑ ููุดุฑ ูููุฐุฌ ููุดู ูู ุงูุจูุงูุงุช ุงููุงูุนูุฉ.

ุชููุฑ ููุชุจุฉ ๐ค Datasets ุฏุงูุฉ `Dataset.train_test_split()` ุงูุชู ุชุณุชูุฏ ุฅูู ุงููุธููุฉ ุงูุดููุฑุฉ ูู `scikit-learn`. ุฏุนููุง ูุณุชุฎุฏููุง ูุชูุณูู ูุฌููุนุฉ ุงูุชุฏุฑูุจ ูุฏููุง ุฅูู ุชูุณููุงุช "train" ู"validation" (ูุญุฏุฏ ูุณูุท `seed` ูุฅููุงููุฉ ุฅุนุงุฏุฉ ุงูุฅูุชุงุฌ):

```py
drug_dataset_clean = drug_dataset["train"].train_test_split(train_size=0.8, seed=42)
# ุฅุนุงุฏุฉ ุชุณููุฉ ุชูุณูู "test" ุงูุงูุชุฑุงุถู ุฅูู "validation"
drug_dataset_clean["validation"] = drug_dataset_clean.pop("test")
# ุฅุถุงูุฉ ูุฌููุนุฉ "test" ุฅูู ูุงุฆู `DatasetDict`
drug_dataset_clean["test"] = drug_dataset["test"]
drug_dataset_clean
```

```python out
DatasetDict({
train: Dataset({
features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount', 'review_length', 'review_clean'],
num_rows: 110811
})
validation: Dataset({
features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount', 'review_length', 'review_clean'],
num_rows: 27703
})
test: Dataset({
features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount', 'review_length', 'review_clean'],
num_rows: 46108
})
})
```

ุฑุงุฆุน! ููุฏ ูููุง ุงูุขู ุจุฅุนุฏุงุฏ ูุฌููุนุฉ ุจูุงูุงุช ุฌุงูุฒุฉ ูุชุฏุฑูุจ ุจุนุถ ุงูููุงุฐุฌ ุนูููุง! ูู [ุงููุตู 5](/course/chapter5/5)ุ ุณูุฑููู ููููุฉ ุชุญููู ูุฌููุนุงุช ุงูุจูุงูุงุช ุฅูู Hugging Face Hubุ ูููู ุงูุขู ุฏุนููุง ูููู ุชุญููููุง ุจุงููุธุฑ ูู ุจุนุถ ุงูุทุฑู ุงูุชู ููููู ูู ุฎูุงููุง ุญูุธ ูุฌููุนุงุช ุงูุจูุงูุงุช ุนูู ุฌูุงุฒู ุงููุญูู.

## ุญูุธ ูุฌููุนุฉ ุงูุจูุงูุงุช [[saving-a-dataset]]

<Youtube id="blF9uxYcKHo"/>

ุนูู ุงูุฑุบู ูู ุฃู ๐ค Datasets ุณุชููู ุจุชุฎุฒูู ูู ูุฌููุนุฉ ุจูุงูุงุช ุชู ุชูุฒูููุง ูุงูุนูููุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง ุนูููุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุชุ ุฅูุง ุฃู ููุงู ุฃููุงุชูุง ุณุชุฑุบุจ ูููุง ูู ุญูุธ ูุฌููุนุฉ ุงูุจูุงูุงุช ุนูู ุงููุฑุต (ุนูู ุณุจูู ุงููุซุงูุ ูู ุญุงูุฉ ุญุฐู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช). ููุง ูู ููุถุญ ูู ุงูุฌุฏูู ุฃุฏูุงูุ ุชููุฑ ๐ค Datasets ุซูุงุซ ูุธุงุฆู ุฑุฆูุณูุฉ ูุญูุธ ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุชูุณููุงุช ูุฎุชููุฉ:

| ุชูุณูู ุงูุจูุงูุงุช | ุงูุฏุงูุฉ |
| :---------: | :--------------------: |
|    Arrow    | `Dataset.save_to_disk()` |
|     CSV     |    `Dataset.to_csv()`    |
|    JSON     |   `Dataset.to_json()`    |

ุนูู ุณุจูู ุงููุซุงูุ ุฏุนููุง ูุญูุธ ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุธููุฉ ุงูุฎุงุตุฉ ุจูุง ุจุชูุณูู Arrow:

```py
drug_dataset_clean.save_to_disk("drug-reviews")
```

ุณูุคุฏู ูุฐุง ุฅูู ุฅูุดุงุก ุฏููู ุจุงููููู ุงูุชุงูู:

```
drug-reviews/
โโโ dataset_dict.json
โโโ test
โ   โโโ dataset.arrow
โ   โโโ dataset_info.json
โ   โโโ state.json
โโโ train
โ   โโโ dataset.arrow
โ   โโโ dataset_info.json
โ   โโโ indices.arrow
โ   โโโ state.json
โโโ validation
โโโ dataset.arrow
โโโ dataset_info.json
โโโ indices.arrow
โโโ state.json
```

ุญูุซ ูููููุง ุฃู ูุฑู ุฃู ูู ุชูุณูู ูุฑุชุจุท ุจุฌุฏูู *dataset.arrow* ุงูุฎุงุต ุจูุ ูุจุนุถ ุงูุจูุงูุงุช ุงููุตููุฉ ูู *dataset_info.json* ู *state.json*. ููููู ุงุนุชุจุงุฑ ุชูุณูู Arrow ูุฌุฏูู ูุชุทูุฑ ูู ุงูุฃุนูุฏุฉ ูุงูุตููู ุงูุชู ุชู ุชุญุณูููุง ูุจูุงุก ุชุทุจููุงุช ุนุงููุฉ ุงูุฃุฏุงุก ููุนุงูุฌุฉ ูููู ูุฌููุนุงุช ุงูุจูุงูุงุช ุงููุจูุฑุฉ.

ุจูุฌุฑุฏ ุญูุธ ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูููููุง ุชุญููููุง ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `load_from_disk()` ููุง ููู:

```py
from datasets import load_from_disk

drug_dataset_reloaded = load_from_disk("drug-reviews")
drug_dataset_reloaded
```

```python out
DatasetDict({
train: Dataset({
features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount', 'review_length'],
num_rows: 110811
})
validation: Dataset({
features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount', 'review_length'],
num_rows: 27703
})
test: Dataset({
features: ['patient_id', 'drugName', 'condition', 'review', 'rating', 'date', 'usefulCount', 'review_length'],
num_rows: 46108
})
})
```

ุจุงููุณุจุฉ ูุชูุณููุงุช CSV ูJSONุ ูุชุนูู ุนูููุง ุชุฎุฒูู ูู ุชูุณูู ูููู ูููุตู. ุฅุญุฏู ุทุฑู ุงูููุงู ุจุฐูู ูู ุนู ุทุฑูู ุงูุชูุฑุงุฑ ุนุจุฑ ุงูููุงุชูุญ ูุงูููู ูู ูุงุฆู `DatasetDict`:

```py
for split, dataset in drug_dataset_clean.items():
dataset.to_json(f"drug-reviews-{split}.jsonl")
```

ูุฐุง ูุญูุธ ูู ุชูุณูู ุจุชูุณูู [JSON Lines](https://jsonlines.org)ุ ุญูุซ ูุชู ุชุฎุฒูู ูู ุตู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุณุทุฑ ูุงุญุฏ ูู JSON. ูููุง ููู ูุซุงู ุนูู ููููุฉ ุธููุฑ ุงูุณุทุฑ ุงูุฃูู:

```py
!head -n 1 drug-reviews-train.jsonl
```

```python out
{"patient_id":141780,"drugName":"Escitalopram","condition":"depression","review":"\"I seemed to experience the regular side effects of LEXAPRO, insomnia, low sex drive, sleepiness during the day. I am taking it at night because my doctor said if it made me tired to take it at night. I assumed it would and started out taking it at night. Strange dreams, some pleasant. I was diagnosed with fibromyalgia. Seems to be helping with the pain. Have had anxiety and depression in my family, and have tried quite a few other medications that haven't worked. Only have been on it for two weeks but feel more positive in my mind, want to accomplish more in my life. Hopefully the side effects will dwindle away, worth it to stick with it from hearing others responses. Great medication.\"","rating":9.0,"date":"May 29, 2011","usefulCount":10,"review_length":125}
```

ุจุนุฏ ุฐููุ ูููููุง ุงุณุชุฎุฏุงู ุงูุชูููุงุช ูู [ุงููุตู 2](/course/chapter5/2) ูุชุญููู ูููุงุช JSON ููุง ููู:

```py
data_files = {
"train": "drug-reviews-train.jsonl",
"validation": "drug-reviews-validation.jsonl",
"test": "drug-reviews-test.jsonl",
}
drug_dataset_reloaded = load_dataset("json", data_files=data_files)
```

ููุฐุง ูุฎุชุชู ุฑุญูุชูุง ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ๐ค Datasets! ุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญ ูุฏููุง ูุฌููุนุฉ ุจูุงูุงุช ูุธููุฉ ูุชุฏุฑูุจ ูููุฐุฌ ุนูููุงุ ุฅููู ุจุนุถ ุงูุฃููุงุฑ ุงูุชู ููููู ุชุฌุฑุจุชูุง:

1. ุงุณุชุฎุฏู ุงูุชูููุงุช ูู [ุงููุตู 3](/course/chapter3) ูุชุฏุฑูุจ ูุตูู ููููู ุงูุชูุจุค ุจุญุงูุฉ ุงููุฑูุถ ุจูุงุกู ุนูู ูุฑุงุฌุนุฉ ุงูุฏูุงุก.
2. ุงุณุชุฎุฏู ุฎุท ุฃูุงุจูุจ "summarization" ูู [ุงููุตู 1](/course/chapter1) ูุชูููุฏ ููุฎุตุงุช ูููุฑุงุฌุนุงุช.

ุจุนุฏ ุฐููุ ุณูููู ูุธุฑุฉ ุนูู ููููุฉ ุชูููู ๐ค Datasets ูู ูู ุงูุนูู ูุน ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูุถุฎูุฉ ุฏูู ููุงุฏ ูุณุงุญุฉ ุงูุชุฎุฒูู ุนูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุงูุฎุงุต ุจู!