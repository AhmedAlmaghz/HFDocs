# ุงูุจูุงูุงุช ุงูุถุฎูุฉุ ๐ค ูุฌููุนุงุช ุงูุจูุงูุงุช ูุฅููุงุฐู! 

<CourseFloatingBanner chapter={5}
classNames="absolute z-10 right-0 top-0"
notebooks={[
{label: "Google Colab", value: "https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/ar/chapter5/section4.ipynb"},
{label: "Aws Studio", value: "https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/ar/chapter5/section4.ipynb"},
]} /> 

ูู ูุนุฏ ูู ุบูุฑ ุงููุฃููู ูู ุงูููุช ุงูุญุงูู ุฃู ุชุฌุฏ ููุณู ุชุนูู ูุน ูุฌููุนุงุช ุจูุงูุงุช ูุชุนุฏุฏุฉ ุงูุฌูุฌุงุจุงูุชุ ุฎุงุตุฉ ุฅุฐุง ููุช ุชุฎุทุท ูุชุฏุฑูุจ ูุญูู ูุซู BERT ุฃู GPT-2 ูู ุงูุตูุฑ. ูู ูุฐู ุงูุญุงูุงุชุ ุญุชู _ุชุญููู_ ุงูุจูุงูุงุช ูููู ุฃู ูููู ุชุญุฏููุง. ุนูู ุณุจูู ุงููุซุงูุ ูุชููู ูุฌูุน WebText ุงููุณุชุฎุฏู ูุชุฏุฑูุจ GPT-2 ูู ุฃูุซุฑ ูู 8 ููุงููู ูุซููุฉ ู40 ุฌูุฌุงุจุงูุช ูู ุงููุต - ุชุญููู ูุฐุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู (RAM) ูู ุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุงูุฎุงุต ุจู ูู ุงููุญุชูู ุฃู ูุตูุจู ุจููุจุฉ ููุจูุฉ! 

ูุญุณู ุงูุญุธุ ุชู ุชุตููู ๐ค Datasets ููุชุบูุจ ุนูู ูุฐู ุงููููุฏ. ููู ูุญุฑุฑู ูู ูุดุงูู ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ูู ุฎูุงู ุงูุชุนุงูู ูุน ูุฌููุนุงุช ุงูุจูุงูุงุช ุนูู ุฃููุง ูููุงุช _memory-mapped_ุ ููู ุญุฏูุฏ ุงููุฑุต ุงูุตูุจ ูู ุฎูุงู _streaming_ ุงูุฅุฏุฎุงูุงุช ูู ูุฌููุนุฉ ูู ุงูุจูุงูุงุช. 

<Youtube id="JwISwTCPPWo"/> 

ูู ูุฐุง ุงููุณูุ ุณูุณุชูุดู ูุฐู ุงูููุฒุงุช ูู ๐ค Datasets ูุน ูุฌููุนุฉ ุจูุงูุงุช ุถุฎูุฉ ุจุญุฌู 825 ุฌูุฌุงุจุงูุช ุชูุนุฑู ุจุงุณู [the Pile](https://pile.eleuther.ai). ูููุจุฏุฃ! 

## ูุง ูู The Pileุ 

The Pile ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ุจูุงูุงุช ูุตูุฉ ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุฃูุดุฃุชูุง [EleutherAI](https://www.eleuther.ai) ูุชุฏุฑูุจ ููุงุฐุฌ ุงููุบุฉ ูุงุณุนุฉ ุงููุทุงู. ูุชุถูู ูุฌููุนุฉ ูุชููุนุฉ ูู ูุฌููุนุงุช ุงูุจูุงูุงุชุ ุจูุง ูู ุฐูู ุงูููุงูุงุช ุงูุนูููุฉุ ููุณุชูุฏุนุงุช ุดูุฑุฉ GitHubุ ูุงููุต ุงูููุฑุดููุญ ูู ุงูููุจ. ุชุชููุฑ ูุฌููุนุฉ ุจูุงูุงุช ุงูุชุฏุฑูุจ ูู [ููุทุน ุจุญุฌู 14 ุฌูุฌุงุจุงูุช](https://the-eye.eu/public/AI/pile/)ุ ูููููู ุฃูุถูุง ุชูุฒูู ุงูุนุฏูุฏ ูู [ุงูููููุงุช ุงููุฑุฏูุฉ](https://the-eye.eu/public/AI/pile_preliminary_components/). ุฏุนููุง ูุจุฏุฃ ุจุฅููุงุก ูุธุฑุฉ ุนูู ูุฌููุนุฉ ุจูุงูุงุช PubMed Abstractsุ ูุงูุชู ูู ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ูู ุงูููุฎุตุงุช ูู 15 ููููู ููุดูุฑ ุทุจู ุญููู ุนูู [PubMed](https://pubmed.ncbi.nlm.nih.gov/). ุชุชููุฑ ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุชูุณูู [JSON Lines](https://jsonlines.org) ูุถุบูุท ุจุงุณุชุฎุฏุงู ููุชุจุฉ `zstandard`ุ ูุฐูู ูุญุชุงุฌ ุฃููุงู ุฅูู ุชุซุจูุชูุง: 

```py
!pip install zstandard
``` 

ุจุนุฏ ุฐููุ ูููููุง ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุงูุทุฑููุฉ ุงูุฎุงุตุฉ ุจุงููููุงุช ุงูุจุนูุฏุฉ ุงูุชู ุชุนูููุงูุง ูู [ุงููุณู 2](/course/chapter5/2): 

```py
from datasets import load_dataset

# ูุณุชุบุฑู ูุฐุง ุงูุฃูุฑ ุจุถุน ุฏูุงุฆู ููุชูููุฐุ ูุฐุง ุงุญุตู ุนูู ุงูุดุงู ุฃู ุงููููุฉ ุฃุซูุงุก ุงูุชุธุงุฑู :)
data_files = "https://the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst"
pubmed_dataset = load_dataset("json", data_files=data_files, split="train")
pubmed_dataset
``` 

```python out
Dataset({
features: ['meta', 'text'],
num_rows: 15518009
})
``` 

ูููููุง ุฃู ูุฑู ุฃู ููุงู 15,518,009 ุตููู ู2 ุฃุนูุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุง - ูุฐุง ูุซูุฑ! 

<Tip> 

โ ุจุดูู ุงูุชุฑุงุถูุ ุณูููู ๐ค Datasets ุจูู ุถุบุท ุงููููุงุช ุงููุงุฒูุฉ ูุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช. ุฅุฐุง ููุช ุชุฑูุฏ ุงูุญูุงุธ ุนูู ูุณุงุญุฉ ุงููุฑุต ุงูุตูุจุ ูููููู ุชูุฑูุฑ `DownloadConfig(delete_extracted=True)` ุฅูู ูุณูุท `download_config` ูู `load_dataset()`. ุฑุงุฌุน [ุงููุซุงุฆู](https://huggingface.co/docs/datasets/package_reference/builder_classes#datasets.DownloadConfig) ููุฒูุฏ ูู ุงูุชูุงุตูู. 

</Tip> 

ุฏุนููุง ูุชููุฏ ูุญุชููุงุช ุงููุซุงู ุงูุฃูู: 

```py
pubmed_dataset[0]
``` 

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
'text': 'Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
``` 

ุญุณููุงุ ูุจุฏู ูุฐุง ูุซู ููุฎุต ูููุงู ุทุจู. ุงูุขู ุฏุนููุง ูุฑู ููุฏุงุฑ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงูุชู ุงุณุชุฎุฏููุงูุง ูุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช! 

## ุณุญุฑ memory-mapping 

ููุงู ุทุฑููุฉ ุจุณูุทุฉ ูููุงุณ ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ูู Python ุจุงุณุชุฎุฏุงู ููุชุจุฉ [`psutil`](https://psutil.readthedocs.io/en/latest/)ุ ูุงูุชู ูููู ุชุซุจูุชูุง ุจุงุณุชุฎุฏุงู `pip` ููุง ููู: 

```python
!pip install psutil
``` 

ูููุฑ ูุฆุฉ `Process` ุงูุชู ุชุชูุญ ููุง ุงูุชุญูู ูู ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ูุนูููุฉ ุงูุญุงููุฉ ููุง ููู: 

```py
import psutil

# ูุชู ุงูุชุนุจูุฑ ุนู Process.memory_info ุจุงูุจุงูุชุ ูุฐุง ูู ุจุงูุชุญููู ุฅูู ููุบุงุจุงูุช
print(f"RAM used: {psutil.Process().memory_info().rss / (1024 * 1024):.2f} MB")
``` 

```python out
RAM used: 5678.33 MB
``` 

ููุง ูุดูุฑ `rss` ุฅูู _resident set size_ุ ููู ุงูุฌุฒุก ูู ุงูุฐุงูุฑุฉ ุงูุฐู ุชุดุบูู ุงูุนูููุฉ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู. ูุชุถูู ูุฐุง ุงูููุงุณ ุฃูุถูุง ุงูุฐุงูุฑุฉ ุงูุชู ูุณุชุฎุฏููุง ููุณุฑ Python ูุงูููุชุจุงุช ุงูุชู ูููุง ุจุชุญููููุงุ ูุฐุง ูุฅู ุงููููุฉ ุงููุนููุฉ ูู ุงูุฐุงูุฑุฉ ุงููุณุชุฎุฏูุฉ ูุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ุฃุตุบุฑ ููููุงู. ููููุงุฑูุฉุ ุฏุนููุง ูุฑู ุญุฌู ูุฌููุนุฉ ุงูุจูุงูุงุช ุนูู ุงููุฑุตุ ุจุงุณุชุฎุฏุงู `dataset_size` ุงูุณูุฉ. ูุธุฑูุง ูุฃู ุงููุชูุฌุฉ ูุนุจุฑ ุนููุง ุจุงูุจุงูุช ูุซู ุงูุณุงุจูุ ูุชุนูู ุนูููุง ุชุญููููุง ูุฏูููุง ุฅูู ุฌูุฌุงุจุงูุช: 

```py
print(f"Number of files in dataset : {pubmed_dataset.dataset_size}")
size_gb = pubmed_dataset.dataset_size / (1024**3)
print(f"Dataset size (cache file) : {size_gb:.2f} GB")
``` 

```python out
Number of files in dataset : 20979437051
Dataset size (cache file) : 19.54 GB
``` 

ุฑุงุฆุน - ุนูู ุงูุฑุบู ูู ุฃูู ูุจูุบ ุญุฌูู 20 ุฌูุฌุงุจุงูุช ุชูุฑูุจูุงุ ุฅูุง ุฃููุง ูุงุฏุฑูู ุนูู ุชุญููู ูุฌููุนุฉ ุงูุจูุงูุงุช ูุงููุตูู ุฅูููุง ุจุงุณุชุฎุฏุงู ุฐุงูุฑุฉ ูุตูู ุนุดูุงุฆู ุฃูู ุจูุซูุฑ! 

<Tip> 

โ๏ธ **ุฌุฑุจู!** ุงุฎุชุฑ ูุงุญุฏุฉ ูู [ุงูููุงุทุน ุงููุฑุนูุฉ](https://the-eye.eu/public/AI/pile_preliminary_components/) ูู The Pile ุฃูุจุฑ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุฃู ุงูููุชุจู ุงูุฎุงุต ุจูุ ููู ุจุชุญููููุง ุจุงุณุชุฎุฏุงู ๐ค Datasetsุ ูููุงุณ ููุฏุงุฑ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงููุณุชุฎุฏูุฉ. ูุงุญุธ ุฃูู ููุญุตูู ุนูู ููุงุณ ุฏูููุ ุณุชุฑุบุจ ูู ุงูููุงู ุจุฐูู ูู ุนูููุฉ ุฌุฏูุฏุฉ. ููููู ุงูุนุซูุฑ ุนูู ุงูุฃุญุฌุงู ุงููุถุบูุทุฉ ููู ููุทุน ูุฑุนู ูู ุงูุฌุฏูู 1 ูู [ูุฑูุฉ The Pile](https://arxiv.org/abs/2101.00027). 

</Tip> 

ุฅุฐุง ููุช ูุนุชุงุฏูุง ุนูู Pandasุ ููุฏ ุชุฃุชู ูุฐู ุงููุชูุฌุฉ ูููุงุฌุฃุฉ ุจุณุจุจ ูุงุนุฏุฉ Wes McKinney ุงูุดููุฑุฉ [rule of thumb](https://wesmckinney.com/blog/apache-arrow-pandas-internals/) ุงูุชู ุชุญุชุงุฌูุง ุนุงุฏุฉู ุฅูู 5 ุฅูู 10 ุฃุถุนุงู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุญุฌู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู. ุฅุฐูุ ููู ูุญู ๐ค Datasets ูุดููุฉ ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ูุฐูุ ๐ค Datasets ุชุนุงูู ูู ูุฌููุนุฉ ุจูุงูุงุช ุนูู ุฃููุง [ููู memory-mapped](https://en.wikipedia.org/wiki/Memory-mapped_file)ุ ูุงูุฐู ูููุฑ ุฎุฑูุทุฉ ุจูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุชุฎุฒูู ูุธุงู ุงููููุงุช ุงูุฐู ูุณูุญ ููููุชุจุฉ ุจุงููุตูู ุฅูู ุนูุงุตุฑ ูุฌููุนุฉ ุงูุจูุงูุงุช ูุชุดุบูููุง ุฏูู ุงูุญุงุฌุฉ ุฅูู ุชุญููููุง ุจุงููุงูู ูู ุงูุฐุงูุฑุฉ. 

ูููู ุฃูุถูุง ูุดุงุฑูุฉ ูููุงุช memory-mapped ุนุจุฑ ุนูููุงุช ูุชุนุฏุฏุฉุ ููุง ููููู ุงูุฃุณุงููุจ ูุซู `Dataset.map()` ูู ุฃู ุชููู ูุชูุงุฒูุฉ ุฏูู ุงูุญุงุฌุฉ ุฅูู ููู ูุฌููุนุฉ ุงูุจูุงูุงุช ุฃู ูุณุฎูุง. ุชุญุช ุงูุบุทุงุกุ ูุชู ุชุญููู ูุฐู ุงูุฅููุงููุงุช ุฌููุนูุง ุจูุงุณุทุฉ ุชูุณูู ุงูุฐุงูุฑุฉ [Apache Arrow](https://arrow.apache.org) ูููุชุจุฉ [`pyarrow`](https://arrow.apache.org/docs/python/index.html)ุ ููุง ูุฌุนู ุชุญููู ุงูุจูุงูุงุช ููุนุงูุฌุชูุง ุณุฑูุนูุง ููุบุงูุฉ. (ููุฒูุฏ ูู ุงูุชูุงุตูู ุญูู Apache Arrow ูุงูููุงุฑูุงุช ูุน Pandasุ ุฑุงุฌุน [ููุดูุฑ ุงููุฏููุฉ ุงูุฎุงุต ุจู Dejan Simic](https://towardsdatascience.com/apache-arrow-read-dataframe-with-zero-memory-69634092b1a).) ููุดุงูุฏุฉ ุฐูู ูู ุงูุนููุ ุฏุนูุง ูุฌุฑู ุงุฎุชุจุงุฑ ุณุฑุนุฉ ุตุบูุฑ ุนู ุทุฑูู ุงูุชูุฑุงุฑ ุนุจุฑ ุฌููุน ุงูุนูุงุตุฑ ูู ูุฌููุนุฉ ุจูุงูุงุช PubMed Abstracts: 

```py
import timeit

code_snippet = """batch_size = 1000

for idx in range(0, len(pubmed_dataset), batch_size):
_ = pubmed_dataset[idx:idx + batch_size]
"""

time = timeit.timeit(stmt=code_snippet, number=1, globals=globals())
print(
f"Iterated over {len(pubmed_dataset)} examples (about {size_gb:.1f} GB) in "
f"{time:.1f}s, i.e. {size_gb/time:.3f} GB/s"
)
``` 

```python out
'Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s'
``` 

ููุง ุงุณุชุฎุฏููุง ูุญุฏุฉ `timeit` ูู Python ูููุงุณ ููุช ุงูุชูููุฐ ุงูุฐู ุงุณุชุบุฑูู `code_snippet`. ุนุงุฏุฉู ูุง ุชุชููู ูู ุงูุชูุฑุงุฑ ุนุจุฑ ูุฌููุนุฉ ุจูุงูุงุช ุจุณุฑุนุฉ ุชุจูุบ ุจุถุนุฉ ุฃุนุดุงุฑ ูู ุฌูุฌุงุจุงูุช ูู ุงูุซุงููุฉ ุฅูู ุนุฏุฉ ุฌูุฌุงุจุงูุช ูู ุงูุซุงููุฉ. ูุนูู ูุฐุง ุจุดูู ุฑุงุฆุน ุจุงููุณุจุฉ ููุฃุบูุจูุฉ ุงูุนุธูู ูู ุงูุชุทุจููุงุชุ ูููู ูู ุจุนุถ ุงูุฃุญูุงู ุณูุชุนูู ุนููู ุงูุนูู ูุน ูุฌููุนุฉ ุจูุงูุงุช ูุจูุฑุฉ ุฌุฏูุง ุจุญูุซ ูุง ูููู ุชุฎุฒูููุง ุญุชู ุนูู ุงููุฑุต ุงูุตูุจ ูุฌูุงุฒ ุงูููุจููุชุฑ ุงููุญููู ุงูุฎุงุต ุจู. ุนูู ุณุจูู ุงููุซุงูุ ุฅุฐุง ุญุงูููุง ุชูุฒูู The Pile ุจุงููุงููุ ูุณูุญุชุงุฌ ุฅูู 825 ุฌูุฌุงุจุงูุช ูู ูุณุงุญุฉ ุงููุฑุต ุงูุญุฑ! ููุชุนุงูู ูุน ูุฐู ุงูุญุงูุงุชุ ูููุฑ ๐ค Datasets ููุฒุฉ ุงูุจุซ ุงููุจุงุดุฑ ุงูุชู ุชุชูุญ ููุง ุชูุฒูู ุงูุนูุงุตุฑ ูุงููุตูู ุฅูููุง ุฃุซูุงุก ุงูุชูููุ ุฏูู ุงูุญุงุฌุฉ ุฅูู ุชูุฒูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุงููุงูู. ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููููุฉ ุนูู ุฐูู. 

<Tip> 

๐ก ูู ุฏูุงุชุฑ Jupyterุ ููููู ุฃูุถูุง ุชูููุช ุงูุฎูุงูุง ุจุงุณุชุฎุฏุงู ูุธููุฉ [`%%timeit` ุงูุณุญุฑูุฉ](https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-timeit). 

</Tip>
## ูุฌููุนุงุช ุงูุจูุงูุงุช ุงููุชุฏููุฉ[[streaming-datasets]]

ูุชูููู ุจุซ ูุฌููุนุฉ ุงูุจูุงูุงุชุ ูู ูุง ุนููู ูุนูู ูู ุชูุฑูุฑ ูุณูุท `streaming=True` ุฅูู ุฏุงูุฉ `load_dataset()`. ุนูู ุณุจูู ุงููุซุงูุ ุฏุนูุง ูุญูู ูุฌููุนุฉ ุจูุงูุงุช ุฎูุงุตุงุช PubMed ูุฑุฉ ุฃุฎุฑูุ ูููู ูู ูุถุน ุงูุจุซ:

```py
pubmed_dataset_streamed = load_dataset(
"json", data_files=data_files, split="train", streaming=True
)
```

ุจุฏูุงู ูู ูุงุฆู `Dataset` ุงููุฃููู ุงูุฐู ูุงุฌููุงู ูู ุฃูุงูู ุฃุฎุฑู ูู ูุฐุง ุงููุตูุ ูุฅู ุงููุงุฆู ุงูุฐู ุชู ุฅุฑุฌุงุนู ูุน `streaming=True` ูู `IterableDataset`. ููุง ููุญู ุงูุงุณูุ ูููุตูู ุฅูู ุนูุงุตุฑ `IterableDataset` ูุญุชุงุฌ ุฅูู ุงูุชูุฑุงุฑ ูููู. ูููููุง ุงููุตูู ุฅูู ุงูุนูุตุฑ ุงูุฃูู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุชุฏููุฉ ุนูู ุงููุญู ุงูุชุงูู:

```py
next(iter(pubmed_dataset_streamed))
```

```python out
{'meta': {'pmid': 11409574, 'language': 'eng'},
'text': 'The prevalence of hypoxaemia in children under 5 years of age with acute lower respiratory infections (ALRI), and the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...'}
```

ูููู ูุนุงูุฌุฉ ุงูุนูุงุตุฑ ูู ูุฌููุนุฉ ุจูุงูุงุช ูุชุฏููุฉ ุฃุซูุงุก ุงูุชููู ุจุงุณุชุฎุฏุงู `IterableDataset.map()`ุ ููู ูุง ูููุฏ ุฃุซูุงุก ุงูุชุฏุฑูุจ ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุชููููุฒ ุงููุฏุฎูุงุช. ุงูุนูููุฉ ูู ููุณูุง ุชูุงููุง ููุง ูุนููุง ูุชููููุฒ ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุง ูู [ุงููุตู 3](/course/chapter3)ุ ูุงููุฑู ุงููุญูุฏ ูู ุฃู ุงูุฅุฎุฑุงุฌ ูุชู ุฅุฑุฌุงุนู ูุงุญุฏูุง ุชูู ุงูุขุฎุฑ:

```py
from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained("distilbert-base-uncased")
tokenized_dataset = pubmed_dataset_streamed.map(lambda x: tokenizer(x["text"]))
next(iter(tokenized_dataset))
```

```python out
{'input_ids': [101, 4958, 5178, 4328, 6779, ...], 'attention_mask': [1, 1, 1, 1, 1, ...]}
```

<Tip>
๐ก ูุชุณุฑูุน ุนูููุฉ ุงูุชููููุฒ ูุน ุงูุจุซุ ููููู ุชูุฑูุฑ `batched=True`ุ ููุง ุฑุฃููุง ูู ุงููุณู ุงูุฃุฎูุฑ. ุณุชุนุงูุฌ ุงูุฃูุซูุฉ ุฏูุนุฉ ุชูู ุงูุฃุฎุฑูุ ุญุฌู ุงูุฏูุนุฉ ุงูุงูุชุฑุงุถู ูู 1000 ููููู ุชุญุฏูุฏู ุจุงุณุชุฎุฏุงู ูุณูุท `batch_size`.
</Tip>

ููููู ุฃูุถูุง ุฎูุท ูุฌููุนุฉ ุจูุงูุงุช ูุชุฏููุฉ ุจุงุณุชุฎุฏุงู `IterableDataset.shuffle()`ุ ูููู ุนูู ุนูุณ `Dataset.shuffle()`ุ ูุฅู ูุฐุง ูุง ูุฎูุท ุณูู ุงูุนูุงุตุฑ ุงูููุฌูุฏุฉ ูู ุญุฌู `buffer_size` ูุญุฏุฏ ูุณุจููุง:

```py
shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=10_000, seed=42)
next(iter(shuffled_dataset))
```

```python out
{'meta': {'pmid': 11410799, 'language': 'eng'},
'text': 'Randomized study of dose or schedule modification of granulocyte colony-stimulating factor in chemotherapy for elderly patients with lung cancer ...'}
```

ูู ูุฐุง ุงููุซุงูุ ูููุง ุจุงุฎุชูุงุฑ ูุซุงู ุนุดูุงุฆู ูู ุจูู ุฃูู 10000 ูุซุงู ูู ุงููุฎุฒู ุงููุคูุช. ุจูุฌุฑุฏ ุงููุตูู ุฅูู ูุซุงูุ ูุชู ููุก ููุงูู ูู ุงููุฎุฒู ุงููุคูุช ุจุงููุซุงู ุงูุชุงูู ูู ุงูููุฑุณ (ุฃู ุงููุซุงู 10001 ูู ุงูุญุงูุฉ ุฃุนูุงู). ููููู ุฃูุถูุง ุชุญุฏูุฏ ุนูุงุตุฑ ูู ูุฌููุนุฉ ุจูุงูุงุช ูุชุฏููุฉ ุจุงุณุชุฎุฏุงู ุฏุงูุชูู `IterableDataset.take()` ู`IterableDataset.skip()`ุ ูุงููุชูู ุชุนููุงู ุจุทุฑููุฉ ููุงุซูุฉ ูู `Dataset.select()`. ุนูู ุณุจูู ุงููุซุงูุ ูุงุฎุชูุงุฑ ุฃูู 5 ุฃูุซูุฉ ูู ูุฌููุนุฉ ุจูุงูุงุช ุฎูุงุตุงุช PubMedุ ูููููุง ุงูููุงู ุจูุง ููู:

```py
dataset_head = pubmed_dataset_streamed.take(5)
list(dataset_head)
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
'text': 'The prevalence of hypoxaemia in children under 5 years of age with acute lower respiratory infections (ALRI) ...'},
{'meta': {'pmid': 11409575, 'language': 'eng'},
'text': 'Clinical signs of hypoxaemia in children with acute lower respiratory infection: indicators of oxygen therapy ...'},
{'meta': {'pmid': 11409576, 'language': 'eng'},
'text': "Hypoxaemia in children with severe pneumonia in Papua New Guinea ..."},
{'meta': {'pmid': 11409577, 'language': 'eng'},
'text': 'Oxygen concentrators and cylinders ...'},
{'meta': {'pmid': 11409578, 'language': 'eng'},
'text': 'Oxygen supply in rural africa ...'}]
```

ุจุงููุซูุ ููููู ุงุณุชุฎุฏุงู ุฏุงูุฉ `IterableDataset.skip()` ูุชูุณูู ุงูุชุฏุฑูุจ ูุงูุชุญูู ูู ูุฌููุนุฉ ุจูุงูุงุช ูุฎุชูุทุฉ ููุง ููู:

```py
# ุชุฎุทู ุฃูู 1000 ูุซุงู ูุฅุฏุฑุงุฌ ุงูุจุงูู ูู ูุฌููุนุฉ ุงูุชุฏุฑูุจ
train_dataset = shuffled_dataset.skip(1000)
# ุฎุฐ ุฃูู 1000 ูุซุงู ููุฌููุนุฉ ุงูุชุญูู
validation_dataset = shuffled_dataset.take(1000)
```

ุฏุนููุง ูุฎุชุชู ุงุณุชูุดุงููุง ูุจุซ ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุชุทุจูู ุดุงุฆุน: ุงูุฌูุน ุจูู ูุฌููุนุงุช ุจูุงูุงุช ูุชุนุฏุฏุฉ ูุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ูุงุญุฏุฉ. ุชููุฑ ููุชุจุฉ ๐ค Datasets ุฏุงูุฉ `interleave_datasets()` ุงูุชู ุชุญูู ูุงุฆูุฉ ูู ูุงุฆูุงุช `IterableDataset` ุฅูู ูุงุฆู `IterableDataset` ูุงุญุฏุ ุญูุซ ูุชู ุงูุญุตูู ุนูู ุนูุงุตุฑ ูุฌููุนุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุนู ุทุฑูู ุงูุชูุงูุจ ุจูู ุงูุฃูุซูุฉ ุงููุตุฏุฑ. ูุฐู ุงูุฏุงูุฉ ูููุฏุฉ ุจุดูู ุฎุงุต ุนูุฏูุง ุชุญุงูู ุงูุฌูุน ุจูู ูุฌููุนุงุช ุจูุงูุงุช ูุจูุฑุฉุ ูุฐูู ููุซุงูุ ุฏุนูุง ูุจุซ ูุฌููุนุฉ ูุฑุนูุฉ ูู Pileุ ููู ูุฌููุนุฉ ุจูุงูุงุช FreeLawุ ูุงูุชู ูู ูุฌููุนุฉ ุจูุงูุงุช ุจุญุฌู 51 ุฌูุฌุงุจุงูุช ูู ุงูุขุฑุงุก ุงููุงููููุฉ ูู ุงููุญุงูู ุงูุฃูุฑูููุฉ:

```py
law_dataset_streamed = load_dataset(
"json",
data_files="https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst",
split="train",
streaming=True,
)
next(iter(law_dataset_streamed))
```

```python out
{'meta': {'case_ID': '110921.json',
'case_jurisdiction': 'scotus.tar.gz',
'date_created': '2010-04-28T17:12:49Z'},
'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}
```

ูุฐู ุงููุฌููุนุฉ ูู ุงูุจูุงูุงุช ูุจูุฑุฉ ุจูุง ูููู ูุฅุฌูุงุฏ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ููุนุธู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงููุญูููุฉุ ููุน ุฐูู ููุฏ ุชูููุง ูู ุชุญููููุง ูุงููุตูู ุฅูููุง ุฏูู ุนูุงุก! ุฏุนูุง ุงูุขู ูุฌูุน ุงูุฃูุซูุฉ ูู ูุฌููุนุงุช ุจูุงูุงุช FreeLaw ูPubMed Abstracts ุจุงุณุชุฎุฏุงู ุฏุงูุฉ `interleave_datasets()` :

```py
from itertools import islice
from datasets import interleave_datasets

combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])
list(islice(combined_dataset, 2))
```

```python out
[{'meta': {'pmid': 11409574, 'language': 'eng'},
'text': 'The prevalence of hypoxaemia in children under 5 years of age with acute lower respiratory infections (ALRI) ...'},
{'meta': {'case_ID': '110921.json',
'case_jurisdiction': 'scotus.tar.gz',
'date_created': '2010-04-28T17:12:49Z'},
'text': '\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...'}]
```

ููุงุ ุงุณุชุฎุฏููุง ุฏุงูุฉ `islice()` ูู ูุญุฏุฉ `itertools` ูู ุจุงูุซูู ูุงุฎุชูุงุฑ ุฃูู ูุซุงููู ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุงููุฌูุนุฉุ ููููููุง ุฃู ูุฑู ุฃููุง ุชุชุทุงุจู ูุน ุงูุฃูุซูุฉ ุงูุฃููู ูู ูู ูู ูุฌููุนุชู ุงูุจูุงูุงุช ุงููุตุฏุฑ.

ุฃุฎูุฑูุงุ ุฅุฐุง ููุช ุชุฑูุฏ ุจุซ ูุฌููุนุฉ ุงูุจูุงูุงุช Pile ุจุงููุงูู ุจุญุฌู 825 ุฌูุฌุงุจุงูุชุ ูููููู ุงูุญุตูู ุนูู ุฌููุน ุงููููุงุช ุงููุญุถุฑุฉ ุนูู ุงููุญู ุงูุชุงูู:

```py
base_url = "https://the-eye.eu/public/AI/pile/"
data_files = {
"train": [base_url + "train/" + f"{idx:02d}.jsonl.zst" for idx in range(30)],
"validation": base_url + "val.jsonl.zst",
"test": base_url + "test.jsonl.zst",
}
pile_dataset = load_dataset("json", data_files=data_files, streaming=True)
next(iter(pile_dataset["train"]))
```

```python out
{'meta': {'pile_set_name': 'Pile-CC'},
'text': 'It is done, and submitted. You can play โSurvival of the Tastiestโ on Android, and on the web...'}
```

<Tip>
โ๏ธ **ุฌุฑุจู!** ุงุณุชุฎุฏู ุฅุญุฏู ูุฌููุนุงุช ุจูุงูุงุช Common Crawl ุงููุจูุฑุฉ ูุซู [`mc4`](https://huggingface.co/datasets/mc4) ุฃู [`oscar`](https://huggingface.co/datasets/oscar) ูุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ูุชุนุฏุฏุฉ ุงููุบุงุช ูุชุฏููุฉ ุชูุซู ูุณุจ ุงููุบุงุช ุงูููุทููุฉ ูู ุจูุฏ ูู ุงุฎุชูุงุฑู. ุนูู ุณุจูู ุงููุซุงูุ ุงููุบุงุช ุงููุทููุฉ ุงูุฃุฑุจุน ูู ุณููุณุฑุง ูู ุงูุฃููุงููุฉ ูุงููุฑูุณูุฉ ูุงูุฅูุทุงููุฉ ูุงูุฑููุงูุดูุฉุ ูุฐุง ููููู ูุญุงููุฉ ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ุณููุณุฑูุฉ ุนู ุทุฑูู ุฃุฎุฐ ุนููุงุช ูู ุงููุฌููุนุงุช ุงููุฑุนูุฉ ูู Oscar ููููุง ููุณุจุชูุง ุงูููุทููุฉ.
</Tip>

ุงูุขู ูุฏูู ุฌููุน ุงูุฃุฏูุงุช ุงูุชู ุชุญุชุงุฌูุง ูุชุญููู ููุนุงูุฌุฉ ูุฌููุนุงุช ุงูุจูุงูุงุช ุจุฌููุน ุฃุดูุงููุง ูุฃุญุฌุงููุง - ูููู ูุง ูู ุชูู ูุญุธูุธูุง ุจุดูู ุงุณุชุซูุงุฆูุ ูุณุชุฃุชู ุงูููุทุฉ ูู ุฑุญูุชู ูู ูุนุงูุฌุฉ ุงููุบุงุช ุงูุทุจูุนูุฉ ุญูุซ ุณูุชุนูู ุนููู ุจุงููุนู ุฅูุดุงุก ูุฌููุนุฉ ุจูุงูุงุช ูุญู ุงููุดููุฉ ุงููุทุฑูุญุฉ. ูุฐุง ูู ููุถูุน ุงููุณู ุงูุชุงูู!