# `torch.compile`

ูู PEFTุ ูุนูู [torch.compile](https://pytorch.org/tutorials/intermediate/torch_compile_tutorial.html) ูุน ุจุนุถ ุงูููุฒุงุช ูููู ููุณ ูุน ุฌููุนูุง. ูุงูุณุจุจ ูู ุฃูู ูู ูุนูู ุฏุงุฆููุง ูู ุฃู PEFT ุฏููุงูููู ููุบุงูุฉ ูู ุฃูุงูู ูุนููุฉ (ูุซู ุชุญููู ูุงูุชุจุฏูู ุจูู ุนุฏุฉ ูุญุฏุงุช ุชููููุ ุนูู ุณุจูู ุงููุซุงู)ุ ุงูุฃูุฑ ุงูุฐู ูุฏ ูุณุจุจ ูุดุงูู ูู `torch.compile`. ูู ุฃูุงูู ุฃุฎุฑูุ ูุฏ ูุนูู `torch.compile`ุ ููููู ูู ูููู ุณุฑูุนูุง ููุง ูู ูุชููุน ุจุณุจุจ ุงููุทุงุน ุงูุฑุณู ุงูุจูุงูู.

ุฅุฐุง ูู ุชุดุงูุฏ ุฃู ุฎุทุฃุ ููุฐุง ูุง ูุนูู ุจุงูุถุฑูุฑุฉ ุฃู `torch.compile` ุนูู ุจุดูู ุตุญูุญ. ููุฏ ูุนุทูู ูุฎุฑุฌูุงุ ูููู ุงููุฎุฑุฌ ุบูุฑ ุตุญูุญ. ูุตู ูุฐุง ุงูุฏููู ูุง ูุนูู ูุน `torch.compile` ููุง ูุง ูุนูู.

> [!TIP]
> ูุง ูู ููุฐูุฑ ุฎูุงู ุฐููุ ุชู ุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช `torch.compile` ุงูุงูุชุฑุงุถูุฉ.

## ุงูุชุฏุฑูุจ ูุงูุงุณุชูุชุงุฌ ูุน `torch.compile`

ูุฐู ุงูููุฒุงุช **ุชุนูู** ูุน `torch.compile`. ุชู ุงุฎุชุจุงุฑ ูู ูุง ูู ูุฏุฑุฌ ุฃุฏูุงู ูุน ูููุฐุฌ ูุบูู ุณุจุจู:

- ุงูุชุฏุฑูุจ ุจุงุณุชุฎุฏุงู `Trainer` ูู ๐ค ูุญููุงุช
- ุงูุชุฏุฑูุจ ุจุงุณุชุฎุฏุงู ุญููุฉ PyTorch ูุฎุตุตุฉ
- ุงูุงุณุชูุชุงุฌ
- ุงูุชูููุฏ

ุชู ุงุฎุชุจุงุฑ ูุญุฏุงุช ุงูุชูููู ุงูุชุงููุฉ ุจูุฌุงุญ:

- AdaLoRA
- BOFT
- IAยณ
- ุถุจุท ูุนูุงุฑ ุงูุทุจูุฉ
- LoHa
- LoRA
- LoRA + DoRA
- OFT
- VeRA

ูุง ุชุนูู ูุญุฏุงุช ุงูุชูููู ุงูุชุงููุฉ ุจุดูู ุตุญูุญ ููุชุฏุฑูุจ ุฃู ุงูุงุณุชูุชุงุฌ ุนูุฏ ุงุณุชุฎุฏุงู `torch.compile`:

- LoKr
- LoRA ุงูุชู ุชุณุชูุฏู ุทุจูุงุช ุงูุชุถููู

## ููุฒุงุช PEFT ุงููุชูุฏูุฉ ูุน `torch.compile`

ูููุง ููู ุจุนุถ ููุฒุงุช PEFT ุงููุชูุฏูุฉ ุงูุชู **ุชุนูู**. ุชู ุงุฎุชุจุงุฑูุง ุฌููุนูุง ูุน LoRA:

- `modules_to_save` (ุฃู `config = LoraConfig(..., modules_to_save=...)`)
- ุฏูุฌ ูุญุฏุงุช ุงูุชูููู (ูุงุญุฏุฉ ุฃู ุฃูุซุฑ)
- ุฏูุฌ ูุญุฏุงุช ุชูููู ูุชุนุฏุฏุฉ ูู ูุญุฏุฉ ุชูููู ูุงุญุฏุฉ (ุฃู ุงุณุชุฏุนุงุก `model.add_weighted_adapter(...)`)

ุจุดูู ุนุงูุ ูููููุง ุฃู ูุชููุน ุฃูู ุฅุฐุง ูุงูุช ุงูููุฒุฉ ุชุนูู ุจุดูู ุตุญูุญ ูุน LoRA ููุฏุนููุฉ ุฃูุถูุง ุจูุงุณุทุฉ ุฃููุงุน ูุญุฏุงุช ุงูุชูููู ุงูุฃุฎุฑูุ ููุฌุจ ุฃู ุชุนูู ุฃูุถูุง ูููุน ูุญุฏุฉ ุงูุชูููู ุชูู.

ููุฒุงุช PEFT ุงููุชูุฏูุฉ ุงูุชุงููุฉ **ูุง ุชุนูู** ุจุงูุงูุชุฑุงู ูุน `torch.compile`. ุชู ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ูุน LoRA:

- ุงุณุชุฎุฏุงู ูุญุฏุงุช ุชูููู PEFT ูุน ุงูุชูููู (bitsandbytes)
- ุงูุงุณุชูุชุงุฌ ุจุงุณุชุฎุฏุงู ูุญุฏุงุช ุชูููู ูุชุนุฏุฏุฉ
- ุงูุชูุฑูุบ (ุฃู ุงุณุชุฏุนุงุก `model.merge_and_unload()`)
- ุชุนุทูู ูุญุฏุงุช ุงูุชูููู (ุฃู ุงุณุชุฎุฏุงู `with model.disable_adapter()`)
- ุฏูุนุงุช ูุญุฏุงุช ุงูุชูููู ุงููุฎุชูุทุฉ (ุฃู ุงุณุชุฏุนุงุก `model(batch, adapter_names=["__base__", "default"ุ "other"ุ ...])`)

## ุญุงูุงุช ุงูุงุฎุชุจุงุฑ

ุชู ุงุฎุชุจุงุฑ ุฌููุน ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงููุฐููุฑุฉ ุฃุนูุงู ุฏุงุฎู [`peft/tests/test_torch_compile.py`](https://github.com/huggingface/peft/blob/main/tests/test_torch_compile.py). ุฅุฐุง ููุช ุชุฑูุฏ ุงูุชุญูู ุจูุฒูุฏ ูู ุงูุชูุตูู ูู ููููุฉ ุงุฎุชุจุงุฑูุง ูููุฒุฉ ูุนููุฉุ ูุฑุฌู ุงูุงูุชูุงู ุฅูู ูุฐุง ุงูููู ูุงูุชุญูู ูู ุงูุงุฎุชุจุงุฑ ุงูุฐู ูุชูุงูู ูุน ุญุงูุฉ ุงูุงุณุชุฎุฏุงู ุงูุฎุงุตุฉ ุจู.

> [!TIP]
> ุฅุฐุง ูุงูุช ูุฏูู ุญุงูุฉ ุงุณุชุฎุฏุงู ุฃุฎุฑู ุญูุซ ุชุนุฑู ุฃู `torch.compile` ูุนูู ุฃู ูุง ูุนูู ูุน PEFTุ ููุฑุฌู ุงููุณุงููุฉ ูู ุฎูุงู ุฅุนูุงููุง ุฃู ูุชุญ ุทูุจ ุณุญุจ ูุฅุถุงูุฉ ุญุงูุฉ ุงูุงุณุชุฎุฏุงู ูุฐู ุฅูู ุญุงูุงุช ุงูุงุฎุชุจุงุฑ ุงููุบุทุงุฉ.