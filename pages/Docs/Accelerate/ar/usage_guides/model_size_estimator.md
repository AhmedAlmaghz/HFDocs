# ููู ุญุฌู ุงููููุฐุฌ ุงูุฐู ูููู ุฃู ูุชุณุน ูุฌูุงุฒู

ููุงู ุฌุงูุจ ุตุนุจ ููุบุงูุฉ ุนูุฏ ุงุณุชูุดุงู ุงูููุงุฐุฌ ุงููุญุชููุฉ ูุงุณุชุฎุฏุงููุง ุนูู ุฌูุงุฒู ููู ูุนุฑูุฉ ูุฏู ุญุฌู ุงููููุฐุฌ ุงูุฐู ุณูุชู *ุชุซุจูุชู* ูู ุงูุฐุงูุฑุฉ ูุน ุจุทุงูุฉ ุงูุฑุณููุงุช ุงูุญุงููุฉ ูุฏูู (ูุซู ุชุญููู ุงููููุฐุฌ ุนูู CUDA).

ููููุณุงุนุฏุฉ ูู ุงูุชุฎููู ูู ุฐููุ ูููุฑ ๐ค Accelerate ูุงุฌูุฉ ุณุทุฑ ุฃูุงูุฑ ูู ุฎูุงู `accelerate estimate-memory`. ุณูุณุงุนุฏู ูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุนูู ุงุณุชุฎุฏุงููุ ููุง ูููู ุชููุนูุ ููู ุงูููุงูุฉุ ุณูุชู ุฑุจุทู ุจุงูุชุฌุฑุจุฉ ุงูุชูุงุนููุฉ ุงููุณุชุถุงูุฉ ุนูู ๐ค Hub ูุงูุชู ุณุชุณูุญ ูู ุญุชู ุจูุดุฑ ูุฐู ุงููุชุงุฆุฌ ูุจุงุดุฑุฉ ูู ูุณุชูุฏุน ุงููููุฐุฌ!

ุญุงูููุงุ ูุฏุนู ุงูุจุญุซ ุนู ุงูููุงุฐุฌ ุงูุชู ูููู ุงุณุชุฎุฏุงููุง ูู `timm` ู`transformers`.

<Tip>

ุณุชููู ูุงุฌู ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฐู ุจุชุญููู ุงููููุฐุฌ ูู ุงูุฐุงูุฑุฉ ุนูู ุงูุฌูุงุฒ `meta`ุ ูุฐูู ูุฅููุง ูุง ูููู ูุนูููุง ุจุชูุฒูู ูุชุญููู ุงูุฃูุฒุงู ุงููุงููุฉ ูููููุฐุฌ ูู ุงูุฐุงูุฑุฉุ ููุง ูุญุชุงุฌ ุฅูู ุฐูู. ููุชูุฌุฉ ูุฐููุ ูู ุงูุขูู ุชูุงููุง ููุงุณ ููุงุฐุฌ ุงููุนููุงุช ุงูุชู ุชุจูุบ 8 ูููุงุฑุงุช (ุฃู ุฃูุซุฑ)ุ ุฏูู ุงูููู ุจุดุฃู ูุง ุฅุฐุง ูุงู ุจุฅููุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุชุนุงูู ูุนูุง!

</Tip>

## ุนุฑูุถ Gradio

ูููุง ููู ุจุนุถ ุนุฑูุถ Gradio ุงููุชุนููุฉ ุจูุง ุชู ูุตูู ุฃุนูุงู. ุงูุฃูู ูู ูุณุงุญุฉ ุชูุฏูุฑ ุงูุฐุงูุฑุฉ ุงูุฑุณููุฉ ูู Hugging Faceุ ูุงูุชู ุชุณุชุฎุฏู Accelerate ูุจุงุดุฑุฉ:

<div class="block dark:hidden">
<iframe
src="https://hf-accelerate-model-memory-usage.hf.space?__theme=light"
width="850"
height="1600"
></iframe>
</div>
<div class="hidden dark:block">
<iframe
src="https://hf-accelerate-model-memory-usage.hf.space?__theme=dark"
width="850"
height="1600"
></iframe>
</div>

ูุงู ุฃุญุฏ ุฃุนุถุงุก ุงููุฌุชูุน ุจุชุทููุฑ ุงูููุฑุฉ ูุชูุณูุนูุงุ ููุง ูุชูุญ ูู ุชุตููุฉ ุงูููุงุฐุฌ ูุจุงุดุฑุฉ ููุนุฑูุฉ ูุง ุฅุฐุง ูุงู ุจุฅููุงูู ุชุดุบูู LLM ูุนูู ูุธุฑูุง ููููุฏ GPU ูุชููููุงุช LoRA. ููุนุจ ุจูุ ุฑุงุฌุน [ููุง](https://huggingface.co/spaces/Vokturz/can-it-run-llm) ููุฒูุฏ ูู ุงูุชูุงุตูู.

## ุงูุฃูุฑ

ุนูุฏ ุงุณุชุฎุฏุงู `accelerate estimate-memory`ุ ูุฌุจ ุนููู ุชูุฑูุฑ ุงุณู ุงููููุฐุฌ ุงูุฐู ุชุฑูุฏ ุงุณุชุฎุฏุงููุ ูุฅุทุงุฑ ุงูุนูู ุงููุญุชูู
ุงูุฐู ูุณุชุฎุฏูู ุงููููุฐุฌ (ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนููู ุชููุงุฆููุง)ุ ูุฃููุงุน ุงูุจูุงูุงุช ุงูุชู ุชุฑูุฏ ุชุญููู ุงููููุฐุฌ ุจูุง.

ุนูู ุณุจูู ุงููุซุงูุ ุฅููู ููููุฉ ุญุณุงุจ ุจุตูุฉ ุงูุฐุงูุฑุฉ ูู `bert-base-cased`:

```bash
accelerate estimate-memory bert-base-cased
```

ุณูููู ูุฐุง ุงูุฃูุฑ ุจุชูุฒูู `config.json` ูู `bert-based-cased`ุ ูุชุญููู ุงููููุฐุฌ ุนูู ุงูุฌูุงุฒ `meta`ุ ูุงูุฅุจูุงุบ ุนู ููุฏุงุฑ ุงููุณุงุญุฉ
ุณูุชู ุงุณุชุฎุฏุงูู:

Memory Usage for loading `bert-base-cased`:

| dtype   | Largest Layer | Total Size | Training using Adam |
|---------|---------------|------------|---------------------|
| float32 | 84.95 MB      | 418.18 MB  | 1.61 GB             |
| float16 | 42.47 MB      | 206.59 MB  | 826.36 MB           |
| int8    | 21.24 MB      | 103.29 MB  | 413.18 MB           |
| int4    | 10.62 MB      | 51.65 MB   | 206.59 MB           |

ุงูุชุฑุงุถููุงุ ุณุชุชู ุฅุนุงุฏุชูุง ูุฌููุน ุฃููุงุน ุงูุจูุงูุงุช ุงููุฏุนููุฉ (`int4` ูู ุฎูุงู `float32`)ุ ูููู ุฅุฐุง ููุช ููุชููุง ุจุฃููุงุน ูุญุฏุฏุฉุ ููููู ุชุตููุชูุง.

### ููุชุจุงุช ูุญุฏุฏุฉ

ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ููุชุจุฉ ุงููุตุฏุฑ ุชููุงุฆููุง (ูุซููุง ุญุฏุซ ูู ุญุงูุฉ `bert-base-cased`)ุ ููููู ุชูุฑูุฑ ุงุณู ุงูููุชุจุฉ.

```bash
accelerate estimate-memory HuggingFaceM4/idefics-80b-instruct --library_name transformers
```

Memory Usage for loading `HuggingFaceM4/idefics-80b-instruct`:

| dtype   | Largest Layer | Total Size | Training using Adam |
|---------|---------------|------------|---------------------|
| float32 | 3.02 GB       | 297.12 GB  | 1.16 TB             |
| float16 | 1.51 GB       | 148.56 GB  | 594.24 GB           |
| int8    | 772.52 MB     | 74.28 GB   | 297.12 GB           |
| int4    | 386.26 MB     | 37.14 GB   | 148.56 GB           |

```bash
accelerate estimate-memory timm/resnet50.a1_in1k --library_name timm
```

Memory Usage for loading `timm/resnet50.a1_in1k`:

| dtype   | Largest Layer | Total Size | Training using Adam |
|---------|---------------|------------|---------------------|
| float32 | 9.0 MB        | 97.7 MB    | 390.78 MB           |
| float16 | 4.5 MB        | 48.85 MB   | 195.39 MB           |
| int8    | 2.25 MB       | 24.42 MB   | 97.7 MB             |
| int4    | 1.12 MB       | 12.21 MB   | 48.85 MB            |

### ุฃููุงุน ุจูุงูุงุช ูุญุฏุฏุฉ

ููุง ุฐูุฑูุง ุณุงุจููุงุ ูู ุญูู ุฃููุง ูุนูุฏ `int4` ูู ุฎูุงู `float32` ุจุดูู ุงูุชุฑุงุถูุ ูููู ุงุณุชุฎุฏุงู ุฃู ููุน ุจูุงูุงุช ูู `float32` ู`float16` ู`int8` ู`int4`.

ููููุงู ุจุฐููุ ูู ุจุชูุฑูุฑูุง ุจุนุฏ ุชุญุฏูุฏ `--dtypes`:

```bash
accelerate estimate-memory bert-base-cased --dtypes float32 float16
```

Memory Usage for loading `bert-base-cased`:

| dtype   | Largest Layer | Total Size | Training using Adam |
|---------|---------------|------------|---------------------|
| float32 | 84.95 MB      | 413.18 MB  | 1.61 GB             |
| float16 | 42.47 MB      | 206.59 MB  | 826.36 MB           |

## ุงูุชุญุฐูุฑุงุช ูุน ูุฐู ุงูุขูุฉ ุงูุญุงุณุจุฉ

ุณุชุฎุจุฑู ูุฐู ุงูุขูุฉ ุงูุญุงุณุจุฉ ุจููููุฉ ูููุฉ ุงูุฐุงูุฑุฉ ุงููุงุฒูุฉ ูุชุญููู ุงููููุฐุฌ ููุทุ *ูููุณ* ูุฃุฏุงุก ุงูุงุณุชุฏูุงู.

ูุฐู ุงูุญุณุงุจุงุช ุฏูููุฉ ูู ุญุฏูุฏ ุจุถุน % ูู ุงููููุฉ ุงููุนููุฉุ ูุฐุง ููู ุชููุฑ ูุธุฑุฉ ุฌูุฏุฉ ุฌุฏูุง ุนู ููุฏุงุฑ ุงูุฐุงูุฑุฉ ุงูุชู ุณุชุณุชุบุฑููุง. ุนูู ุณุจูู ุงููุซุงูุ ูุณุชุบุฑู ุชุญููู `bert-base-cased` ูู ุงููุงูุน `413.68 MB` ุนูุฏ ุชุญูููู ุนูู CUDA ุจุฏูุฉ ูุงููุฉุ ูุชูุฏุฑ ุงูุขูุฉ ุงูุญุงุณุจุฉ `413.18 MB`.

ุนูุฏ ุฅุฌุฑุงุก ุงูุงุณุชุฏูุงูุ ููููู ุชููุน ุฅุถุงูุฉ ูุง ูุตู ุฅูู 20% ุฅุถุงููุฉ ููุง ูุฌุฏุชูุง [EleutherAI](https://blog.eleuther.ai/transformer-math/). ุณูููู ุจุฅุฌุฑุงุก ุฃุจุญุงุซ ูุฅูุฌุงุฏ ุชูุฏูุฑ ุฃูุซุฑ ุฏูุฉ ููุฐู ุงููููุ ูุณูููู ุจุชุญุฏูุซ
ูุฐู ุงูุขูุฉ ุงูุญุงุณุจุฉ ุจูุฌุฑุฏ ุงูุงูุชูุงุก.