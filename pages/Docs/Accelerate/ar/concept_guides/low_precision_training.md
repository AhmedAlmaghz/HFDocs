# ุฃุณุงููุจ ุงูุชุฏุฑูุจ ููุฎูุถ ุงูุฏูุฉ

ุฃุฏู ุฅุทูุงู ุฃููุงุน ุฌุฏูุฏุฉ ูู ุงูุฃุฌูุฒุฉ ุฅูู ุธููุฑ ููุงุฐุฌ ุชุฏุฑูุจ ุฌุฏูุฏุฉ ุชุณุชููุฏ ูููุง ุจุดูู ุฃูุถู. ุญุงูููุงุ ูุฃุชู ุฐูู ูู ุดูู ุชุฏุฑูุจ ุจุฏูุฉ 8 ุจุช ุจุงุณุชุฎุฏุงู ุญุฒู ูุซู [TransformersEngine](https://github.com/NVIDIA/TransformerEngine) (TE) ุฃู [MS-AMP](https://github.com/Azure/MS-AMP/tree/main).

ููุญุตูู ุนูู ููุฏูุฉ ูู ุงูููุถูุนุงุช ุงูุชู ููุงูุดูุง ุงููููุ ููุตู ุจูุฑุงุฌุนุฉ [ุฏููู ุงูุงุณุชุฎุฏุงู ููุฎูุถ ุงูุฏูุฉ](../usage_guides/low_precision_training.md) ุญูุซ ุณุชุดูุฑ ุฅููู ูุฐู ุงููุซููุฉ ุจุงูุชุธุงู.

## ูุฎุทุท ุณุฑูุน

ูููุง ููู ูุฎุทุท ุณุฑูุน ูู ูุซุงุฆู MS-AMP ููุถุญ ุฏูุฉ ุงูุจุช ุงููุฎุชููุฉ ููู ุญู ุฃุซูุงุก ุงูุชุฏุฑูุจ:

ูุณุชูู ุงูุชุญุณูู | ุงูุญุณุงุจ (GEMM) | ููู | ุงููุฒู | ุงููุฒู ุงูุฑุฆูุณู | ุชุฏุฑุฌ ุงููุฒู | ุญุงูุงุช ุงููุญุณู
-- | -- | -- | -- | -- | -- | --
FP16 AMP | FP16 | FP32 | FP32 | N/A | FP32 | FP32+FP32
Nvidia TE | FP8 | FP32 | FP32 | N/A | FP32 | FP32+FP32
MS-AMP O1 | FP8 | FP8 | FP16 | N/A | FP8 | FP32+FP32
MS-AMP O2 | FP8 | FP8 | FP16 | N/A | FP8 | FP8+FP16
MS-AMP O3 | FP8 | FP8 | FP8 | FP16 | FP8 | FP8+FP16

## `TransformersEngine`

`TransformersEngine` ูู ุฃูู ุญู ููุญุงููุฉ ุงูุชุฏุฑูุจ ูู ููุทุฉ ุนุงุฆูุฉ 8 ุจุช. ูุนูู ุนู ุทุฑูู ุงุณุชุฎุฏุงู ุทุจูุงุช ุงูุงุณุชุจุฏุงู ุงูุณููุท ูุทุจูุงุช ูุนููุฉ ูู ูููุฐุฌ ูุณุชุฎุฏู ูุญุฑู FP8 ุงูุฎุงุต ุจู ูุชูููู ุนุฏุฏ ุงูุจุชุงุช (ูุซู 32 ุฅูู 8) ุฏูู ุชูููู ุฏูุฉ ุงููููุฐุฌ ุงูููุงุฆู.

ุชุญุฏูุฏูุงุ ุณูุฌุฏ ๐ค Accelerate ุงูุทุจูุงุช ุงูุชุงููุฉ ููุณุชุจุฏููุง ุจุฅุตุฏุงุฑุงุช `TransformersEngine`:

* `nn.LayerNorm` ูู `te.LayerNorm`
* `nn.Linear` ูู `te.Linear`

ููุชูุฌุฉ ูุฐููุ ููุชูู ุจูุง ุงูุฃูุฑ ุจูููุฐุฌ ุชูุฌุฏ ูุนุธู ุทุจูุงุชู ูู BF16ุ ุจูููุง ุชูุฌุฏ ุจุนุถ ุงูุทุจูุงุช ูู FP8 ููุง ูููู ูู ุงูุฐุงูุฑุฉ.

ูู ุงููุงุญูุฉ ุงููุตุตูุฉุ ูุงุญุธูุง ุฃู ููุงุณุจ ุงูุฃุฏุงุก ูุง ุชุจุฏุฃ ูู ุงูุธููุฑ ูุนูููุง ุนูุฏ ุงุณุชุฎุฏุงู `TransformerEngine` ุญุชู ุชุชููู ุงูุบุงูุจูุฉ ุงูุนุธูู ูู ุงูุทุจูุงุช ูู ุงููููุฐุฌ ูู ูุงุชูู ุงูุทุจูุชูู ููุงุณุชุจุฏุงู. ููุชูุฌุฉ ูุฐููุ ุฃุธูุฑุช ุงูููุงุฐุฌ ุงูุฃูุจุฑ ุญุฌููุง ููุท ุชุญุณููุงุช ูู ุงูุฃุฏุงุก ุนูุฏูุง ูุงู ุนุฏุฏ ุงููุนููุงุช ุญูุงูู ุจุถุนุฉ ูููุงุฑุงุช ุฃู ุฃูุซุฑ.

ูููู ุฃู ูุชููู `TransformerEngine` ุงูุนุฏูุฏ ูู ุงูุญุฌุฌ ุงููุฎุชููุฉ ุงูุชู ุชูุฎุตููุต ููููุฉ ุฃุฏุงุฆู ูุญุณุงุจุงุช FP8 ููุง ุชูุนูู. ุชุชููุฑ ูุงุฆูุฉ ูุงููุฉ ุจุงูุญุฌุฌ ุฃุฏูุงู:

* `margin`: ุงููุงูุด ุงูุฐู ุณูุชู ุงุณุชุฎุฏุงูู ููููุงุณ ุชุฏุฑุฌ.
* `interval`: ุงููุงุตู ุงูุฒููู ุงูุฐู ุณูุชู ุงุณุชุฎุฏุงูู ููุฏู ุชูุฑุงุฑ ุฅุนุงุฏุฉ ุญุณุงุจ ุนุงูู ุงููููุงุณ.
* `fp8_format``: ุงูุชูุณูู ุงูุฐู ุณูุชู ุงุณุชุฎุฏุงูู ููุตูุฉ FP8. ูุฌุจ ุฃู ูููู ุฃุญุฏ `E4M3` ุฃู `HYBRID`.
* `amax_history_len`: ุทูู ุงูุชุงุฑูุฎ ุงูุฐู ุณูุชู ุงุณุชุฎุฏุงูู ูุญุณุงุจ ุนุงูู ุงููููุงุณ
* `amax_compute_algo`: ุงูุฎูุงุฑุฒููุฉ ุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุง ูุญุณุงุจ ุนุงูู ุงููููุงุณ. ูุฌุจ ุฃู ูููู ุฃุญุฏ `max` ุฃู `most_recent`.
* `override_linear_precision`: ูุง ุฅุฐุง ูุงู ุณูุชู ุชูููุฐ GEMMS ูู `fprop` ู`dgrad` ู`wgrad` ุจุฏูุฉ ุฃุนูู ุฃู ูุง.

ููููู ุชุฎุตูุต ูู ูููุง ูุฌุฒุก ูู [`utils.FP8RecipeKwargs`] ูููุณุงุนุฏุฉ ูู ุชุญุณูู ุฃุฏุงุก ููุงุฐุฌู.

ุฅุฐุง ูุงุญุธูุง ูู ุงููุฎุทุท ุงููุฐููุฑ ุณุงุจููุงุ ูุฅู TE ูููู ุจุจุณุงุทุฉ ุจุชุญููู ุทุจูุงุช ุงูุญุณุงุจ ุฅูู FP8ุ ูู ุญูู ุฃู ูู ุดูุก ุขุฎุฑ ูููู ูู FP32. ููุชูุฌุฉ ูุฐููุ ููุชูู ุงูุฃูุฑ ุจุงุณุชุฎุฏุงู ูุนุธู ุงูุฐุงูุฑุฉ ููููู ููุนู ุฐูู ุจููุฒุฉ ุถูุงู ุฃูู ูุฏุฑ ูู ุงูุฎุณุงุฑุฉ ูู ุงูุฏูุฉ ุงูููุงุฆูุฉ ุฃุซูุงุก ุงูุชุฏุฑูุจ.

## `MS-AMP`

ูุชุจุน MS-AMP ููุฌูุง ูุฎุชูููุง ุนู `TransformersEngine` ูู ุฎูุงู ุชูููุฑ ุซูุงุซุฉ ูุณุชููุงุช ุชุญุณูู ูุฎุชููุฉ ูุชุญููู ุงููุฒูุฏ ูู ุงูุนูููุงุช ุฅูู FP8 ุฃู FP16.

* ูููู ูุณุชูู ุงูุชุญุณูู ุงูุฃุณุงุณู (`O1`) ุจุฅุฑุณุงู ุงุชุตุงูุงุช ุงูุฃูุฒุงู (ููุง ูู ุงูุญุงู ูู DDP) ูู FP8ุ ููุฎุฒู ุฃูุฒุงู ุงููููุฐุฌ ูู FP16ุ ููุชุฑู ุญุงูุงุช ุงููุญุณู ูู FP32. ุชุชูุซู ุงููุงุฆุฏุฉ ุงูุฑุฆูุณูุฉ ููุณุชูู ุงูุชุญุณูู ูุฐุง ูู ุฃูู ูููููุง ุชูููู ุนุฑุถ ุงููุทุงู ุงูุชุฑุฏุฏู ููุงุชุตุงู ุฅูู ุงููุตู ุชูุฑูุจูุง. ุจุงูุฅุถุงูุฉ ุฅูู ุฐููุ ูุชู ุญูุธ ุงููุฒูุฏ ูู ุฐุงูุฑุฉ GPU ูุธุฑูุง ูุฃู ูุตู ูู ุดูุก ูุชู ุชุญูููู ุฅูู FP8ุ ููุชู ุชุญููู ุงูุฃูุฒุงู ุฅูู FP16. ูู ุงูุฌุฏูุฑ ุจุงูุฐูุฑ ุฃู ููุชุง ุญุงูุชู ุงููุญุณู ุชุธูุงู ูู FP32.

* ูุญุณู ูุณุชูู ุงูุชุญุณูู ุงูุซุงูู (`O2`) ูุฐุง ุนู ุทุฑูู ุชูููู ุฏูุฉ ุญุงูุงุช ุงููุญุณู ุฃูุถูุง. ูุงุญุฏ ูู FP8 ูู ุญูู ุฃู ุงูุขุฎุฑ ูู FP16. ุจุดูู ุนุงูุ ุซุจุช ุฃู ูุฐุง ูู ูููุฑ ุณูู ููุณุจ ุตุงูู ูู ุนุฏู ุชุฏููุฑ ุงูุฏูุฉ ุงูููุงุฆูุฉุ ูุฒูุงุฏุฉ ุณุฑุนุฉ ุงูุชุฏุฑูุจุ ูุชูููู ุงูุฐุงูุฑุฉ ุญูุซ ุฃุตุจุญุช ุงูุขู ูู ุญุงูุฉ ุฅูุง ูู FP16 ุฃู FP8.

* ุฃุฎูุฑูุงุ ูุฏู MS-AMP ูุณุชูู ุชุญุณูู ุซุงูุซ (`O3`) ูุงูุฐู ูุณุงุนุฏ ุฃุซูุงุก ุณููุงุฑูููุงุช DDP ูุซู DeepSpeed. ูุชู ุชุญููู ุฃูุฒุงู ุงููููุฐุฌ ูู ุงูุฐุงูุฑุฉ ุจุงููุงูู ุฅูู FP8ุ ููุชู ุงูุขู ุชุฎุฒูู ุงูุฃูุฒุงู ุงูุฑุฆูุณูุฉ ูู FP16. ููุฐุง ูููู ุชูุงููุง ูู ุงูุฐุงูุฑุฉ ุจุฃุนูู ุนุงูู ุญูุซ ูู ูุนุฏ ูู ุดูุก ุชูุฑูุจูุง ูู FP8ุ ููู ูุชุจู ุณูู ุญุงูุชูู ูู FP16. ุญุงูููุงุ ูุชู ุฏุนู ุฅุตุฏุงุฑุงุช DeepSpeed ุญุชู 0.9.2 ููุทุ ูุฐุง ูุฅู ูุฐู ุงูุฅููุงููุฉ ุบูุฑ ูุฏุฑุฌุฉ ูู ุชูุงูู ๐ค Accelerate.

## ุงูุฌูุน ุจูู ุงูุงุซููู

ููุฒู ุฅุฌุฑุงุก ุงููุฒูุฏ ูู ุงูุชุฌุงุฑุจุ ูููู ููุญุธ ุฃู ุงูุฌูุน ุจูู MS-AMP ูTransformersEngine ูููู ุฃู ูุคุฏู ุฅูู ุฃุนูู ุฅูุชุงุฌูุฉ ูู ุฎูุงู ุงูุงุนุชูุงุฏ ุนูู ูุดุบูุงุช FP8 ุงููุญุณูุฉ ูู NVIDIA ูุงูุงุณุชูุงุฏุฉ ูู ููููุฉ ุชูููู MS-AMP ูุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช.