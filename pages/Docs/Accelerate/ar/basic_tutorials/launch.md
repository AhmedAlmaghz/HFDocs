# ุชุดุบูู ูุตูุต ๐ค Accelerate ุงูุฎุงุตุฉ ุจู
ูู ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุงูุณุงุจูุ ุชู ุชุนุฑููู ุนูู ููููุฉ ุชุนุฏูู ูุต ุงูุชุฏุฑูุจ ุงูุญุงูู ูุงุณุชุฎุฏุงู ๐ค Accelerate.
ูููุง ููู ุงูุฅุตุฏุงุฑ ุงูููุงุฆู ูู ูุฐุง ุงูุฑูุฒ:

```python
from accelerate import Accelerator

accelerator = Accelerator()

model, optimizer, training_dataloader, scheduler = accelerator.prepare(
    model, optimizer, training_dataloader, scheduler
)

for batch in training_dataloader:
    optimizer.zero_grad()
    inputs, targets = batch
    outputs = model(inputs)
    loss = loss_function(outputs, targets)
    accelerator.backward(loss)
    optimizer.step()
    scheduler.step()
```

ูููู ููู ููููู ุชุดุบูู ูุฐุง ุงูุฑูุฒ ูุงุณุชุฎุฏุงู ุงูุฃุฌูุฒุฉ ุงูุฎุงุตุฉ ุงููุชุงุญุฉ ููุ

ุฃููุงูุ ูุฌุจ ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูุฑูุฒ ุฃุนูุงู ูู ุฏุงูุฉุ ูุฌุนูู ูุงุจู ููุงุณุชุฏุนุงุก ููุต ุจุฑูุฌู. ุนูู ุณุจูู ุงููุซุงู:

```diff
  from accelerate import Accelerator
  
+ def main():
      accelerator = Accelerator()

      model, optimizer, training_dataloader, scheduler = accelerator.prepare(
          model, optimizer, training_dataloader, scheduler
      )

      for batch in training_dataloader:
          optimizer.zero_grad()
          inputs, targets = batch
          outputs = model(inputs)
          loss = loss_function(outputs, targets)
          accelerator.backward(loss)
          optimizer.step()
          scheduler.step()

+ if __name__ == "__main__":
+     main()
```

ุจุนุฏ ุฐููุ ุชุญุชุงุฌ ุฅูู ุชุดุบููู ุจุงุณุชุฎุฏุงู `accelerate launch`.

<Tip warning={true}>
ูู ุงููุณุชุญุณู ุชุดุบูู `accelerate config` ูุจู ุงุณุชุฎุฏุงู `accelerate launch` ูุชููุฆุฉ ุจูุฆุชู ุญุณุจ ุชูุถููุงุชู.
ูุฅูุงุ ุณูุณุชุฎุฏู ๐ค Accelerate ุงูุงูุชุฑุงุถูุงุช ุงูุฃุณุงุณูุฉ ุฌุฏูุง ุงุนุชูุงุฏูุง ุนูู ุฅุนุฏุงุฏ ูุธุงูู.
</Tip>

## ุงุณุชุฎุฏุงู ุงูุฃูุฑ accelerate launch
ูุญุชูู ๐ค Accelerate ุนูู ุฃูุฑ CLI ุฎุงุต ููุณุงุนุฏุชู ูู ุชุดุบูู ุงูุฑูุฒ ุงูุฎุงุต ุจู ูู ูุธุงูู ูู ุฎูุงู `accelerate launch`.
ูุบูู ูุฐุง ุงูุฃูุฑ ุฌููุน ุงูุฃูุงูุฑ ุงููุฎุชููุฉ ุงููุงุฒูุฉ ูุชุดุบูู ูุตู ุงูุจุฑูุฌู ุนูู ููุตุงุช ูุฎุชููุฉุ ุฏูู ุงูุญุงุฌุฉ ุฅูู ุชุฐูุฑ ูู ูููุง.

<Tip>
ุฅุฐุง ููุช ูุนุชุงุฏูุง ุนูู ุชุดุบูู ุงููุตูุต ุงูุจุฑูุฌูุฉ ูู PyTorch ุจููุณูุ ูุซู `torchrun`ุ ูููููู ุงูุงุณุชูุฑุงุฑ ูู ุงูููุงู ุจุฐูู. ููุณ ูู ุงูุถุฑูุฑู ุงุณุชุฎุฏุงู `accelerate launch`.
</Tip>

ููููู ุชุดุบูู ูุตู ุงูุจุฑูุฌู ุจุณุฑุนุฉ ุจุงุณุชุฎุฏุงู ูุง ููู:

```bash
accelerate launch {script_name.py} --arg1 --arg2 ...
```

ุถุน ุจุจุณุงุทุฉ `accelerate launch` ูู ุจุฏุงูุฉ ุฃูุฑูุ ููุฑุฑ ุงูุญุฌุฌ ูุงููุนููุงุช ุงูุฅุถุงููุฉ ุฅูู ูุตู ุงูุจุฑูุฌู ูุงุญููุง ููุง ูู ูุนุชุงุฏ!

ูุธุฑูุง ูุฃู ูุฐุง ุงูุฃูุฑ ูุดุบู ุทุฑู ุงูุฅุทูุงู ุงููุฎุชููุฉ ูู torchุ ููููู ุชุนุฏูู ุฌููุน ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงููุชููุนุฉ ููุง ุฃูุถูุง.
ุนูู ุณุจูู ุงููุซุงูุ ูููุง ููู ููููุฉ ุงุณุชุฎุฏุงู `accelerate launch` ูุน ูุญุฏุฉ ูุนุงูุฌุฉ ุฑุณููุงุช (GPU) ูุงุญุฏุฉ:

```bash
CUDA_VISIBLE_DEVICES="0" accelerate launch {script_name.py} --arg1 --arg2 ...
```

ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู `accelerate launch` ุฏูู ุชูููุฐ `accelerate config` ุฃููุงูุ ูููู ูุฏ ุชุญุชุงุฌ ุฅูู ุชูุฑูุฑ ูุนููุงุช ุงูุชูููู ุงูุตุญูุญุฉ ูุฏูููุง.
ูู ูุฐู ุงูุญุงูุฉุ ุณูููู ๐ค Accelerate ุจุงุชุฎุงุฐ ุจุนุถ ุงููุฑุงุฑุงุช ุญูู ุงููุนููุงุช ุงููุชุบูุฑุฉ ููุ ุนูู ุณุจูู ุงููุซุงูุ ุฅุฐุง ูุงูุช ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ูุชุงุญุฉุ ูุณูุณุชุฎุฏููุง ุฌููุนูุง ุจุดูู ุงูุชุฑุงุถู ุฏูู ุงูุฏูุฉ ุงููุฎุชูุทุฉ.
ูููุง ููู ููููุฉ ุงุณุชุฎุฏุงู ุฌููุน ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ูุงูุชุฏุฑูุจ ูุน ุชุนุทูู ุงูุฏูุฉ ุงููุฎุชูุทุฉ:

```bash
accelerate launch --multi_gpu {script_name.py} {--arg1} {--arg2} ...
```

ุฃู ุนู ุทุฑูู ุชุญุฏูุฏ ุนุฏุฏ ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุง:

```bash
accelerate launch --num_processes=2 {script_name.py} {--arg1} {--arg2} ...
```

ูููุฒูุฏ ูู ุงูุชุญุฏูุฏุ ูุฌุจ ุนููู ุชูุฑูุฑ ุงููุนููุงุช ุงููุทููุจุฉ ุจููุณู. ุนูู ุณุจูู ุงููุซุงูุ ูููุง ููู ููููุฉ
ููููู ุฃูุถูุง ุชุดุบูู ูุฐุง ุงููุต ุงูุจุฑูุฌู ููุณู ุนูู ูุญุฏุชู ูุนุงูุฌุฉ ุฑุณููุงุช (GPU) ุจุงุณุชุฎุฏุงู ุงูุฏูุฉ ุงููุฎุชูุทุฉ ูุน ุชุฌูุจ ุฌููุน ุงูุชุญุฐูุฑุงุช:

```bash
accelerate launch --multi_gpu --mixed_precision=fp16 --num_processes=2 {script_name.py} {--arg1} {--arg2} ...
```

ูุนุฑุถ ูุงุฆูุฉ ูุงููุฉ ูู ุงููุนููุงุช ุงูุชู ููููู ุชูุฑูุฑูุงุ ูู ุจุชุดุบูู:

```bash
accelerate launch -h
```

<Tip>
ุญุชู ุฅุฐุง ูู ุชูู ุชุณุชุฎุฏู ๐ค Accelerate ูู ุฑูุฒูุ ูููููู ูุง ุชุฒุงู ุงุณุชุฎุฏุงู ุฃุฏุงุฉ ุงูุฅุทูุงู ูุจุฏุก ูุตูุตู ุงูุจุฑูุฌูุฉ!
</Tip>

ููุญุตูู ุนูู ุชูุถูุญ ูุฑุฆู ููุฐุง ุงูุงุฎุชูุงูุ ูุฅู ุฃูุฑ `accelerate launch` ุงูุณุงุจู ุนูู ูุญุฏุงุช ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ุงููุชุนุฏุฏุฉ ุณูุจุฏู ุดูุฆูุง ูุซู ูุง ููู ูุน `torchrun`:

```bash
MIXED_PRECISION="fp16" torchrun --nproc_per_node=2 --num_machines=1 {script_name.py} {--arg1} {--arg2} ...
```

ููููู ุฃูุถูุง ุชุดุบูู ูุตู ุงูุจุฑูุฌู ุจุงุณุชุฎุฏุงู ูุงุฌูุฉ ุณุทุฑ ุงูุฃูุงูุฑ (CLI) ููุฅุทูุงู ููุต ุจุฑูุฌู Python ููุณูุ ููุง ููููู ุงููุฏุฑุฉ ุนูู ุชูุฑูุฑ ุณููููุงุช ุงูุฅุทูุงู ุงูุฃุฎุฑู ุงูุฎุงุตุฉ ุจู Python. ููููุงู ุจุฐููุ ุงุณุชุฎุฏู `accelerate.commands.launch` ุจุฏูุงู ูู `accelerate launch`:

```bash
python -m accelerate.commands.launch --num_processes=2 {script_name.py} {--arg1} {--arg2}
```

ุฅุฐุง ููุช ุชุฑูุฏ ุชูููุฐ ุงููุต ุงูุจุฑูุฌู ุจุงุณุชุฎุฏุงู ุฃู ุฃุนูุงู Python ุฃุฎุฑูุ ูููููู ุชูุฑูุฑูุง ุฃูุถูุง ุจุดูู ูุดุงุจู ูู `-m`ุ ูุซู
ูู ุงููุซุงู ุงูุชุงูู ุงูุฐู ููููู stdout ู stderr ุบูุฑ ุงููุคูู:

```bash
python -u -m accelerate.commands.launch --num_processes=2 {script_name.py} {--arg1} {--arg2}
```

<Tip>
ููููู ุชุดุบูู ุฑูุฒู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ (CPU) ุฃูุถูุง! ูุฐุง ูููุฏ ูุฃุบุฑุงุถ ุงูุชุตุญูุญ ูุงูุงุฎุชุจุงุฑ ุนูู ููุงุฐุฌ ูุจูุงูุงุช ุงูุฃูุนุงุจ.
```bash
accelerate launch --cpu {script_name.py} {--arg1} {--arg2}
```
</Tip>

## ููุงุฐุง ูุฌุจ ุนููู ุฏุงุฆููุง ุงุณุชุฎุฏุงู `accelerate config`
ููุงุฐุง ูู ุงููููุฏ ุฃู ุชููู ุฏุงุฆููุง ุจุชุดุบูู `accelerate config`ุ

ุชุฐูุฑ ููุงููุฉ `accelerate launch` ุงูุณุงุจูุฉ ุจุงูุฅุถุงูุฉ ุฅูู `torchrun`ุ
ุจุนุฏ ุงูุชููุฆุฉุ ูุชุดุบูู ูุฐุง ุงููุต ุงูุจุฑูุฌู ูุน ุงูุฃุฌุฒุงุก ุงููุทููุจุฉุ ูุฃูุช ุจุญุงุฌุฉ ููุท ุฅูู ุงุณุชุฎุฏุงู `accelerate launch` ุจุดูู ุตุฑูุญุ ุฏูู ุชูุฑูุฑ ุฃู ุดูุก ุขุฎุฑ:

```bash
accelerate launch {script_name.py} {--arg1} {--arg2} ...
```

## ุงูุชููุฆุงุช ุงููุฎุตุตุฉ
ููุง ุฐูุฑูุง ุณุงุจููุงุ ูุฌุจ ุงุณุชุฎุฏุงู `accelerate launch` ุจุดูู ุฃุณุงุณู ูู ุฎูุงู ุงูุฌูุน ุจูู ุงูุชููุฆุงุช ุงููุญุฏุฏุฉ
ุชู ุฅูุดุงุคูุง ุจุงุณุชุฎุฏุงู ุฃูุฑ `accelerate config`. ูุชู ุญูุธ ูุฐู ุงูุชููุฆุงุช ุฅูู ููู ุจุงุณู `default_config.yaml` ูู ูุฌูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูู ๐ค Accelerate.
ููุน ูุฌูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุฐุง ูู (ุจุชุฑุชูุจ ุชูุงุฒูู ููุฃููููุฉ):

- ูุญุชูู ูุชุบูุฑ ุงูุจูุฆุฉ `HF_HOME` ููุญู ุจู `accelerate`.
- ุฅุฐุง ูู ููู ููุฌูุฏูุงุ ูุณูุชู ุงุณุชุฎุฏุงู ูุญุชูู ูุชุบูุฑ ุงูุจูุฆุฉ `XDG_CACHE_HOME` ููุญููุง ุจู
`huggingface/accelerate`.
- ุฅุฐุง ูู ููู ูุฐุง ููุฌูุฏูุง ุฃูุถูุงุ ูุณูุชู ุงุณุชุฎุฏุงู ุงููุฌูุฏ `~/.cache/huggingface/accelerate`.

ููุญุตูู ุนูู ุชููุฆุงุช ูุชุนุฏุฏุฉุ ูููู ุชูุฑูุฑ ุนูู `--config_file` ุฅูู ุฃูุฑ `accelerate launch` ููุชุฑููุง
ุจูููุน ููู yaml ุงููุฎุตุต.

ูุฏ ุชุจุฏู ููู yaml ุงููุฎุตุต ููุง ููู ููุญุฏุชู ูุนุงูุฌุฉ ุฑุณููุงุช (GPU) ุนูู ุฌูุงุฒ ูุงุญุฏ ุจุงุณุชุฎุฏุงู `fp16` ููุฏูุฉ ุงููุฎุชูุทุฉ:

```yaml
compute_environment: LOCAL_MACHINE
deepspeed_config: {}
distributed_type: MULTI_GPU
fsdp_config: {}
machine_rank: 0
main_process_ip: null
main_process_port: null
main_training_function: main
mixed_precision: fp16
num_machines: 1
num_processes: 2
use_cpu: false
```

ูุจุฏู ุชุดุบูู ูุต ุจุฑูุฌู ูู ูููุน ููู yaml ุงููุฎุตุต ููุง ููู:

```bash
accelerate launch --config_file {path/to/config/my_config_file.yaml} {script_name.py} {--arg1} {--arg2} ...
```

## ุงูุชุฏุฑูุจ ูุชุนุฏุฏ ุงูุนูุฏ
ุงูุชุฏุฑูุจ ูุชุนุฏุฏ ุงูุนูุฏ ุจุงุณุชุฎุฏุงู ๐ค Accelerate ูุดุงุจู ูู [ุงูุชุฏุฑูุจ ูุชุนุฏุฏ ุงูุนูุฏ ุจุงุณุชุฎุฏุงู torchrun](https://pytorch.org/tutorials/intermediate/ddp_series_multinode.html). ุฃุจุณุท ุทุฑููุฉ ูุจุฏุก ุชุดุบูู ุงูุชุฏุฑูุจ ูุชุนุฏุฏ ุงูุนูุฏ ูู ุงูููุงู ุจูุง ููู:

- ูู ุจูุณุฎ ุฑูุฒู ุงูุฃุณุงุณู ูุจูุงูุงุชู ุฅูู ุฌููุน ุงูุนูุฏ. (ุฃู ุถุนูุง ูู ูุธุงู ูููุงุช ูุดุชุฑู)
- ูู ุจุชููุฆุฉ ุญุฒู Python ุงูุฎุงุตุฉ ุจู ุนูู ุฌููุน ุงูุนูุฏ.
- ูู ุจุชุดุบูู `accelerate config` ุนูู ุงูุนูุฏุฉ ุงููุฑุฏูุฉ ุงูุฑุฆูุณูุฉ ุฃููุงู. ุจุนุฏ ุชุญุฏูุฏ ุนุฏุฏ ุงูุนูุฏุ ุณููุทูุจ ููู ุชุญุฏูุฏ ุชุฑุชูุจ ูู ุนูุฏุฉ (ุณูููู ูุฐุง 0 ููุนูุฏุฉ ุงูุฑุฆูุณูุฉ/ุงูุฑุฆูุณูุฉ)ุ ุฅูู ุฌุงูุจ ุนููุงู IP ููููุฐ ุงูุนูููุฉ ุงูุฑุฆูุณูุฉ. ูุฐุง ูุทููุจ ูุนูุฏ ุงูุนูุงู ููุชูุงุตู ูุน ุงูุนูููุฉ ุงูุฑุฆูุณูุฉ. ุจุนุฏ ุฐููุ ููููู ูุณุฎ ุฃู ุฅุฑุณุงู ููู ุงูุชููุฆุฉ ูุฐุง ุนุจุฑ ุฌููุน ุงูุนูุฏ ุงูุฎุงุตุฉ ุจูุ ูุชุบููุฑ `machine_rank` ุฅูู 1 ู2 ู3ุ ููุง ุฅูู ุฐูู ูุชุฌูุจ ุงูุงุถุทุฑุงุฑ ุฅูู ุชุดุบูู ุงูุฃูุฑ (ุฃู ุงุชุจุงุน ุชูุฌููุงุชูู ูุจุงุดุฑุฉู ููุชุดุบูู ุจุงุณุชุฎุฏุงู `torchrun`)
ุจูุฌุฑุฏ ููุงูู ุจุฐููุ ููููู ุจุฏุก ุชุดุบูู ุงูุชุฏุฑูุจ ูุชุนุฏุฏ ุงูุนูุฏ ุนู ุทุฑูู ุชุดุบูู `accelerate launch` (ุฃู `torchrun`) ุนูู ุฌููุน ุงูุนูุฏ.

<Tip>
ูู ุงูุถุฑูุฑู ุชุดุบูู ุงูุฃูุฑ ุนูู ุฌููุน ุงูุนูุฏ ูุจุฏุก ูู ุดูุกุ ูููุณ ููุท ุชุดุบููู ูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ. ููููู ุงุณุชุฎุฏุงู ุดูุก ูุซู SLURM ุฃู ูููุฐ ุนูููุฉ ูุฎุชูู ููุงูุชูุงู ุญูู ูุฐุง ุงูุดุฑุท ูุงุณุชุฏุนุงุก ูู ุดูุก ูู ุฃูุฑ ูุงุญุฏ.
</Tip>

<Tip>
ูู ุงููุณุชุญุณู ุงุณุชุฎุฏุงู ุนููุงู IP ุงูุฏุงุฎูู ูุนูุฏุชู ุงูุฑุฆูุณูุฉ ุจุฏูุงู ูู ุนููุงู IP ุงูุนุงู ูุชุญููู ุฃูุถู ุญุงูุฉ ุชุฃุฎูุฑ. ูุฐุง ูู ุนููุงู `192.168.x.x` ุฃู `172.x.x.x` ุงูุฐู ุชุฑุงู ุนูุฏ ุชุดุบูู `hostname -I` ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ.
</Tip>

ููุญุตูู ุนูู ููุฑุฉ ุฃูุถู ุญูู ุงูุชุฏุฑูุจ ูุชุนุฏุฏ ุงูุนูุฏุ ุชุญูู ูู ูุซุงููุง ูู [ุงูุชุฏุฑูุจ ูุชุนุฏุฏ ุงูุนูุฏ ุจุงุณุชุฎุฏุงู FSDP](https://huggingface.co/blog/ram-efficient-pytorch-fsdp).